# Redis 配置文件 - 用于生产环境持久化
# 适用于 Windows / Linux / Docker 环境

# ============================================
# 网络配置
# ============================================
bind 127.0.0.1
port 6379
timeout 0
tcp-keepalive 300

# ============================================
# 持久化配置 - RDB快照
# ============================================
# 自动快照策略（时间-变更次数）
save 900 1      # 900秒内至少1个key变化时保存
save 300 10     # 300秒内至少10个key变化时保存
save 60 10000   # 60秒内至少10000个key变化时保存

# RDB文件配置
dbfilename dump.rdb
dir ./data
rdbcompression yes
rdbchecksum yes

# ============================================
# 持久化配置 - AOF追加日志
# ============================================
# 启用AOF持久化（推荐与RDB同时使用）
appendonly yes
appendfilename "appendonly.aof"

# AOF同步策略
# - always: 每次写操作都同步（最安全但最慢）
# - everysec: 每秒同步一次（推荐，平衡性能和安全）
# - no: 由操作系统决定何时同步（最快但风险最高）
appendfsync everysec

# AOF重写配置
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# ============================================
# 内存管理
# ============================================
maxmemory 256mb
maxmemory-policy allkeys-lru

# ============================================
# 日志配置
# ============================================
loglevel notice
logfile "redis.log"

# ============================================
# 安全配置
# ============================================
# 生产环境请设置密码
# requirepass your_strong_password_here

# ============================================
# 性能优化
# ============================================
databases 16
slowlog-log-slower-than 10000
slowlog-max-len 128

# ============================================
# 高级配置
# ============================================
# 启用惰性删除（异步删除大key）
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
