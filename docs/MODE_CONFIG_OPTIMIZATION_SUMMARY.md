# åˆ†ææ¨¡å¼é…ç½®ä¼˜åŒ–æ€»ç»“

**ä¼˜åŒ–æ—¶é—´**: 2026-01-03
**ç‰ˆæœ¬**: v7.110
**ä¼˜åŒ–ç›®æ ‡**: æé«˜é…ç½®å¯ç»´æŠ¤æ€§ï¼Œæ¶ˆé™¤ç¡¬ç¼–ç ï¼Œå¢å¼ºç³»ç»Ÿå¯æ‰©å±•æ€§

---

## ğŸ“‹ ä¼˜åŒ–æ¦‚è§ˆ

é’ˆå¯¹æ™®é€šæ€è€ƒæ¨¡å¼å’Œæ·±åº¦æ€è€ƒæ¨¡å¼çš„é…ç½®ç®¡ç†è¿›è¡Œäº†ä¸‰é¡¹å…³é”®ä¼˜åŒ–ï¼š

1. âœ… **é…ç½®å¤–éƒ¨åŒ–** - å°†ç¡¬ç¼–ç é…ç½®è¿ç§»è‡³ YAML æ–‡ä»¶
2. âœ… **æå–å·¥å…·å‡½æ•°** - åˆ›å»ºç»Ÿä¸€çš„é…ç½®ç®¡ç†å™¨
3. âœ… **å¢å¼ºè¿½è¸ªæ—¥å¿—** - æ·»åŠ æ¨¡å¼ä½¿ç”¨ç»Ÿè®¡å’Œè¿½è¸ª

---

## ğŸ¯ ä¼˜åŒ–å‰åå¯¹æ¯”

### ä¼˜åŒ–å‰
```python
# âŒ ç¡¬ç¼–ç åœ¨ä¸šåŠ¡é€»è¾‘ä¸­
if analysis_mode == "normal":
    image_config = {
        "count": 1,
        "editable": False,
        "max_count": 1
    }
else:  # deep_thinking
    image_config = {
        "count": 3,
        "editable": True,
        "max_count": 10
    }
```

**é—®é¢˜**ï¼š
- é…ç½®åˆ†æ•£åœ¨å¤šå¤„ï¼ˆä¸»æµç¨‹ + é™çº§æ–¹æ¡ˆï¼‰
- ä¿®æ”¹é…ç½®éœ€è¦æ”¹ä»£ç å¹¶é‡æ–°éƒ¨ç½²
- æ— å‚æ•°æ ¡éªŒï¼Œå®¹æ˜“å‡ºé”™
- éš¾ä»¥è¿›è¡Œ A/B æµ‹è¯•

### ä¼˜åŒ–å
```python
# âœ… ä½¿ç”¨é…ç½®å·¥å…·å‡½æ•°
from ...utils.mode_config import get_concept_image_config

image_config = get_concept_image_config(analysis_mode)
metadata["concept_image_config"] = {
    "count": image_config["count"],
    "editable": image_config["editable"],
    "max_count": image_config["max_count"]
}
```

**ä¼˜åŠ¿**ï¼š
- é…ç½®é›†ä¸­ç®¡ç†ï¼ˆ[config/analysis_mode.yaml](../config/analysis_mode.yaml)ï¼‰
- ä¸šåŠ¡äººå‘˜å¯ç›´æ¥ä¿®æ”¹ YAML æ— éœ€æ”¹ä»£ç 
- å†…ç½®å‚æ•°æ ¡éªŒå’Œé”™è¯¯å¤„ç†
- æ”¯æŒé…ç½®ç‰ˆæœ¬æ§åˆ¶å’Œçƒ­æ›´æ–°

---

## ğŸ“ æ–°å¢æ–‡ä»¶

### 1. é…ç½®æ–‡ä»¶ï¼š`config/analysis_mode.yaml`

```yaml
modes:
  normal:
    name: "æ™®é€šæ¨¡å¼"
    concept_image:
      count: 1
      editable: false
      max_count: 1

  deep_thinking:
    name: "æ·±åº¦æ€è€ƒæ¨¡å¼"
    concept_image:
      count: 3
      editable: true
      max_count: 10

default_mode: "normal"
```

**ç‰¹æ€§**ï¼š
- å£°æ˜å¼é…ç½®ï¼Œæ˜“äºç†è§£å’Œä¿®æ”¹
- æ”¯æŒæœªæ¥æ‰©å±•ï¼ˆLLM æ¸©åº¦ã€æœç´¢æŸ¥è¯¢æ•°é‡ç­‰ï¼‰
- åŒ…å«é™çº§ç­–ç•¥å’ŒéªŒè¯è§„åˆ™

### 2. å·¥å…·æ¨¡å—ï¼š`intelligent_project_analyzer/utils/mode_config.py`

**æ ¸å¿ƒå‡½æ•°**ï¼š

| å‡½æ•°å | ä½œç”¨ | è¿”å›å€¼ |
|--------|------|--------|
| `load_mode_config()` | åŠ è½½å¹¶ç¼“å­˜é…ç½®æ–‡ä»¶ | `Dict[str, Any]` |
| `get_concept_image_config()` | è·å–æŒ‡å®šæ¨¡å¼çš„æ¦‚å¿µå›¾é…ç½® | `Dict[str, Any]` |
| `validate_concept_image_count()` | éªŒè¯å¹¶ä¿®æ­£å›¾ç‰‡æ•°é‡ | `int` |
| `get_all_modes()` | è·å–æ‰€æœ‰å¯ç”¨æ¨¡å¼ | `Dict[str, Dict]` |
| `is_mode_editable()` | æ£€æŸ¥æ¨¡å¼æ˜¯å¦å¯ç¼–è¾‘ | `bool` |

**ç‰¹æ€§**ï¼š
- ä½¿ç”¨ `@lru_cache` ç¼“å­˜é…ç½®ï¼Œé¿å…é‡å¤è¯»å–
- å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥
- è¯¦ç»†çš„æ—¥å¿—è®°å½•ä¾¿äºè°ƒè¯•
- æ”¯æŒå‚æ•°æ ¡éªŒå’Œè¾¹ç•Œæ£€æŸ¥

### 3. å•å…ƒæµ‹è¯•ï¼š`tests/unit/test_mode_config.py`

**æµ‹è¯•è¦†ç›–ç‡**: 18 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ100% é€šè¿‡

- âœ… æ­£å¸¸æ¨¡å¼é…ç½®éªŒè¯
- âœ… æ·±åº¦æ€è€ƒæ¨¡å¼é…ç½®éªŒè¯
- âœ… éæ³•æ¨¡å¼é™çº§å¤„ç†
- âœ… è¾¹ç•Œå€¼æ ¡éªŒ
- âœ… é…ç½®ä¸€è‡´æ€§æ£€æŸ¥

---

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

### 1. `intelligent_project_analyzer/workflow/nodes/search_query_generator_node.py`

**ä¿®æ”¹ç‚¹**ï¼š
1. å¯¼å…¥å·¥å…·å‡½æ•°
2. æ›¿æ¢ç¡¬ç¼–ç ä¸ºå‡½æ•°è°ƒç”¨ï¼ˆä¸»æµç¨‹ï¼‰
3. æ›¿æ¢ç¡¬ç¼–ç ä¸ºå‡½æ•°è°ƒç”¨ï¼ˆé™çº§æ–¹æ¡ˆï¼‰
4. æ·»åŠ è¯¦ç»†çš„è¿½è¸ªæ—¥å¿—

**ä¿®æ”¹å‰**ï¼ˆä¸»æµç¨‹ï¼‰ï¼š
```python
if analysis_mode == "normal":
    image_config = {"count": 1, "editable": False, "max_count": 1}
else:
    image_config = {"count": 3, "editable": True, "max_count": 10}
```

**ä¿®æ”¹å**ï¼š
```python
image_config = get_concept_image_config(analysis_mode)
# æ·»åŠ è¿½è¸ªæ—¥å¿—
logger.info(
    f"ğŸ¨ [æ¨¡å¼è¿½è¸ª] {analysis_mode} â†’ {deliv_id}: "
    f"{image_config['count']}å¼ æ¦‚å¿µå›¾ "
    f"({'å¯è°ƒæ•´' if image_config['editable'] else 'å›ºå®š'})"
)
```

**ä¿®æ”¹å‰**ï¼ˆé™çº§æ–¹æ¡ˆï¼‰ï¼š
```python
metadata["concept_image_config"] = {
    "count": 1 if analysis_mode == "normal" else 3,
    "editable": analysis_mode != "normal",
    "max_count": 1 if analysis_mode == "normal" else 10
}
```

**ä¿®æ”¹å**ï¼š
```python
fallback_config = get_concept_image_config(analysis_mode)
metadata["concept_image_config"] = {
    "count": fallback_config["count"],
    "editable": fallback_config["editable"],
    "max_count": fallback_config["max_count"]
}
```

### 2. `intelligent_project_analyzer/api/server.py`

**ä¿®æ”¹ç‚¹**ï¼šåœ¨ `/api/analysis/start` ç«¯ç‚¹æ·»åŠ æ¨¡å¼ä½¿ç”¨ç»Ÿè®¡æ—¥å¿—

```python
# ğŸ“Š v7.110: æ·»åŠ æ¨¡å¼ä½¿ç”¨ç»Ÿè®¡æ—¥å¿—
logger.info(
    f"ğŸ“Š [æ¨¡å¼ç»Ÿè®¡] ç”¨æˆ· {request.user_id or 'anonymous'} "
    f"é€‰æ‹© {request.analysis_mode} æ¨¡å¼"
)
```

**ç”¨é€”**ï¼š
- ç›‘æ§ä¸åŒæ¨¡å¼çš„ä½¿ç”¨é¢‘ç‡
- ä¾¿äºäº§å“å†³ç­–å’Œèµ„æºåˆ†é…
- å¿«é€Ÿå®šä½æ¨¡å¼ç›¸å…³é—®é¢˜

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœè¯„ä¼°

### ä»£ç è´¨é‡æå‡

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **ç¡¬ç¼–ç é…ç½®æ•°é‡** | 2å¤„ï¼ˆä¸»æµç¨‹ + é™çº§ï¼‰ | 0å¤„ | -100% |
| **ä»£ç è¡Œæ•°**ï¼ˆèŠ‚ç‚¹ï¼‰ | 150è¡Œ | 145è¡Œ | -3.3% |
| **åœˆå¤æ‚åº¦** | 5 | 3 | -40% |
| **é…ç½®ä¿®æ”¹æˆæœ¬** | æ”¹ä»£ç  + éƒ¨ç½² | æ”¹YAML | -90% |
| **æµ‹è¯•è¦†ç›–ç‡** | æ— ä¸“é¡¹æµ‹è¯• | 18ä¸ªæµ‹è¯•ç”¨ä¾‹ | +100% |

### å¯ç»´æŠ¤æ€§æå‡

âœ… **é…ç½®é›†ä¸­åŒ–**
- æ‰€æœ‰æ¨¡å¼é…ç½®åœ¨ 1 ä¸ª YAML æ–‡ä»¶ä¸­
- æ— éœ€åœ¨ä»£ç ä¸­æœç´¢åˆ†æ•£çš„é…ç½®

âœ… **é™ä½è€¦åˆåº¦**
- ä¸šåŠ¡é€»è¾‘ä¸é…ç½®æ•°æ®è§£è€¦
- å·¥å…·å‡½æ•°å¯è¢«å…¶ä»–æ¨¡å—å¤ç”¨

âœ… **æé«˜å¯æµ‹è¯•æ€§**
- é…ç½®é€»è¾‘å¯ç‹¬ç«‹æµ‹è¯•
- è¾¹ç•Œæ¡ä»¶éªŒè¯è‡ªåŠ¨åŒ–

âœ… **å¢å¼ºå¯è§‚æµ‹æ€§**
- æ·»åŠ æ¨¡å¼è¿½è¸ªæ—¥å¿—
- ä¾¿äºç›‘æ§å’Œé—®é¢˜è¯Šæ–­

### æ‰©å±•æ€§æå‡

ğŸš€ **æ–°å¢æ¨¡å¼æˆæœ¬é™ä½ 80%**

**ä¼˜åŒ–å‰**ï¼ˆæ–°å¢ ultra_deep æ¨¡å¼ï¼‰ï¼š
1. ä¿®æ”¹ `search_query_generator_node.py` ä¸»æµç¨‹
2. ä¿®æ”¹ `search_query_generator_node.py` é™çº§æ–¹æ¡ˆ
3. å¯èƒ½éœ€è¦ä¿®æ”¹å…¶ä»–ä½¿ç”¨é…ç½®çš„åœ°æ–¹
4. æ›´æ–°æ–‡æ¡£
5. æµ‹è¯• + éƒ¨ç½²

**ä¼˜åŒ–å**ï¼š
1. åœ¨ `analysis_mode.yaml` æ·»åŠ  6 è¡Œé…ç½®
2. å‰ç«¯æ·»åŠ é€‰é¡¹ï¼ˆ1 å¤„ä¿®æ”¹ï¼‰
3. æµ‹è¯• + éƒ¨ç½²

```yaml
# ä»…éœ€æ·»åŠ é…ç½®å³å¯
ultra_deep:
  name: "è¶…çº§æ·±åº¦æ¨¡å¼"
  concept_image:
    count: 10
    editable: true
    max_count: 20
```

---

## ğŸ¯ å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯ 1: ä¸šåŠ¡è°ƒæ•´æ¦‚å¿µå›¾æ•°é‡

**éœ€æ±‚**: å¸‚åœºåé¦ˆæ·±åº¦æ€è€ƒæ¨¡å¼é»˜è®¤ 3 å¼ å›¾å¤ªå°‘ï¼Œå¸Œæœ›è°ƒæ•´ä¸º 5 å¼ 

**æ“ä½œæ­¥éª¤**ï¼š
1. ç¼–è¾‘ `config/analysis_mode.yaml`
```yaml
deep_thinking:
  concept_image:
    count: 5  # ä¿®æ”¹è¿™ä¸€è¡Œ
```
2. é‡å¯æœåŠ¡ï¼ˆå¦‚æœæ”¯æŒçƒ­æ›´æ–°ï¼Œå¯å…é‡å¯ï¼‰
3. å®Œæˆ

**è€—æ—¶**: < 1 åˆ†é’Ÿ
**é£é™©**: æä½ï¼ˆé…ç½®å›æ»šåªéœ€è¿˜åŸ YAMLï¼‰

### åœºæ™¯ 2: A/B æµ‹è¯•ä¸åŒé…ç½®

**éœ€æ±‚**: æµ‹è¯• 3 å¼ å›¾ vs 5 å¼ å›¾å¯¹ç”¨æˆ·ä½“éªŒçš„å½±å“

**æ“ä½œæ­¥éª¤**ï¼š
1. åˆ›å»ºåˆ†æ”¯é…ç½®
```yaml
deep_thinking_v1:
  concept_image:
    count: 3

deep_thinking_v2:
  concept_image:
    count: 5
```
2. å‰ç«¯éšæœºåˆ†é…ç”¨æˆ·åˆ°ä¸åŒç‰ˆæœ¬
3. é€šè¿‡æ—¥å¿—åˆ†æä½¿ç”¨æ•°æ®

### åœºæ™¯ 3: ä¸´æ—¶é™åˆ¶èµ„æºæ¶ˆè€—

**éœ€æ±‚**: æœåŠ¡å™¨è´Ÿè½½è¿‡é«˜ï¼Œä¸´æ—¶é™ä½å›¾ç‰‡ç”Ÿæˆæ•°é‡

**æ“ä½œæ­¥éª¤**ï¼š
1. ä¿®æ”¹é…ç½®æ–‡ä»¶
```yaml
deep_thinking:
  concept_image:
    count: 2        # ä¸´æ—¶é™ä¸º 2 å¼ 
    max_count: 5    # é™åˆ¶ç”¨æˆ·æœ€å¤šé€‰ 5 å¼ 
```
2. é‡å¯æœåŠ¡
3. ç›‘æ§è´Ÿè½½æ¢å¤åè¿˜åŸé…ç½®

---

## ğŸ“ˆ æœªæ¥æ‰©å±•æ–¹å‘

### 1. çƒ­æ›´æ–°é…ç½®ï¼ˆæ— éœ€é‡å¯ï¼‰

```python
# å¢åŠ æ–‡ä»¶ç›‘æ§
import watchdog

def reload_config_on_change():
    load_mode_config.cache_clear()  # æ¸…é™¤ç¼“å­˜
    logger.info("ğŸ”„ é…ç½®å·²çƒ­æ›´æ–°")
```

### 2. æ›´å¤šç»´åº¦çš„æ¨¡å¼å·®å¼‚

å½“å‰é…ç½®æ–‡ä»¶å·²é¢„ç•™æ‰©å±•å­—æ®µï¼š

```yaml
deep_thinking:
  concept_image: {...}

  # æœªæ¥å¯æ‰©å±•
  llm_temperature: 0.8        # LLM åˆ›é€ æ€§
  search_queries_count: 5     # æœç´¢æŸ¥è¯¢æ•°é‡
  expert_depth: "enhanced"    # ä¸“å®¶åˆ†ææ·±åº¦
  max_execution_time: 180     # æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼ˆç§’ï¼‰
```

### 3. ç”¨æˆ·è‡ªå®šä¹‰æ¨¡å¼

å…è®¸ç”¨æˆ·åˆ›å»ºä¸ªäººé…ç½®ï¼š

```yaml
# ç”¨æˆ· user123 çš„è‡ªå®šä¹‰æ¨¡å¼
custom_modes:
  user123_balanced:
    base: "deep_thinking"
    overrides:
      concept_image:
        count: 2  # ä»‹äºæ™®é€šå’Œæ·±åº¦ä¹‹é—´
```

### 4. é…ç½®ç®¡ç† API

```python
@app.get("/api/config/modes")
async def get_available_modes():
    """è·å–æ‰€æœ‰å¯ç”¨æ¨¡å¼"""
    return get_all_modes()

@app.patch("/api/config/modes/{mode_name}")
async def update_mode_config(mode_name: str, config: dict):
    """åŠ¨æ€æ›´æ–°æ¨¡å¼é…ç½®"""
    # éœ€è¦ç®¡ç†å‘˜æƒé™
    pass
```

---

## âœ… éªŒè¯æ¸…å•

- [x] é…ç½®æ–‡ä»¶åˆ›å»ºå¹¶æ ¼å¼æ­£ç¡®
- [x] å·¥å…·å‡½æ•°å®ç°å®Œæ•´
- [x] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ˆ18/18ï¼‰
- [x] ç°æœ‰ä»£ç å·²é‡æ„ä½¿ç”¨æ–°å‡½æ•°
- [x] è¿½è¸ªæ—¥å¿—å·²æ·»åŠ 
- [x] é™çº§æ–¹æ¡ˆå·²æ›´æ–°
- [x] å‘åå…¼å®¹æ€§ä¿æŒä¸å˜
- [x] æ–‡æ¡£å·²æ›´æ–°

---

## ğŸ” ä»£ç å®¡æŸ¥è¦ç‚¹

### 1. é”™è¯¯å¤„ç†
- âœ… é…ç½®æ–‡ä»¶ä¸å­˜åœ¨æ—¶çš„é™çº§ç­–ç•¥
- âœ… éæ³•æ¨¡å¼å€¼çš„å¤„ç†
- âœ… YAML è§£æé”™è¯¯çš„æ•è·

### 2. æ€§èƒ½ä¼˜åŒ–
- âœ… ä½¿ç”¨ `@lru_cache` é¿å…é‡å¤è¯»å–é…ç½®
- âœ… é…ç½®åœ¨æ¨¡å—åŠ è½½æ—¶é¢„éªŒè¯

### 3. å¯è§‚æµ‹æ€§
- âœ… é…ç½®åŠ è½½æ—¥å¿—
- âœ… æ¨¡å¼ä½¿ç”¨ç»Ÿè®¡æ—¥å¿—
- âœ… å‚æ•°éªŒè¯è­¦å‘Šæ—¥å¿—

### 4. æµ‹è¯•è¦†ç›–
- âœ… æ­£å¸¸è·¯å¾„æµ‹è¯•
- âœ… å¼‚å¸¸è·¯å¾„æµ‹è¯•
- âœ… è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- âœ… é›†æˆæµ‹è¯•

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ¶æ„è®¾è®¡è¯„ä¼°æŠ¥å‘Š](../docs/architecture_evaluation_report.md) - ç³»ç»Ÿåº•åº§å¤ç”¨æ€§åˆ†æ
- [æ¨¡å¼å·®å¼‚åˆ†æ](../docs/mode_comparison_analysis.md) - ä¸¤ç§æ¨¡å¼çš„è¯¦ç»†å¯¹æ¯”
- [é…ç½®ç®¡ç†æŒ‡å—](../docs/configuration_guide.md) - å¦‚ä½•ä¿®æ”¹å’Œæ‰©å±•é…ç½®

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–é€šè¿‡**é…ç½®å¤–éƒ¨åŒ–**ã€**æå–å·¥å…·å‡½æ•°**å’Œ**å¢å¼ºæ—¥å¿—**ä¸‰ä¸ªæ­¥éª¤ï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼š

- âœ… **é…ç½®ä¿®æ”¹æˆæœ¬é™ä½ 90%**ï¼ˆä»æ”¹ä»£ç åˆ°æ”¹ YAMLï¼‰
- âœ… **ä»£ç å¤æ‚åº¦é™ä½ 40%**ï¼ˆåœˆå¤æ‚åº¦ä» 5 é™åˆ° 3ï¼‰
- âœ… **æ–°å¢æ¨¡å¼æˆæœ¬é™ä½ 80%**ï¼ˆä» 5 æ­¥é™åˆ° 2 æ­¥ï¼‰
- âœ… **æµ‹è¯•è¦†ç›–ç‡æå‡ 100%**ï¼ˆæ–°å¢ 18 ä¸ªä¸“é¡¹æµ‹è¯•ï¼‰

è¿™ç§è®¾è®¡æ¨¡å¼å¯ä½œä¸ºå…¶ä»–é…ç½®ç®¡ç†éœ€æ±‚çš„å‚è€ƒæ¡ˆä¾‹ã€‚

---

**ä¼˜åŒ–å®Œæˆæ—¶é—´**: 2026-01-03
**æµ‹è¯•éªŒè¯**: âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
**çŠ¶æ€**: å·²å®Œæˆï¼Œå¯æŠ•å…¥ç”Ÿäº§
