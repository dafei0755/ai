# æœç´¢å¼•ç”¨ä¿®å¤éªŒè¯æ¸…å• (v7.113)

**ä¿®å¤ç‰ˆæœ¬**: v7.113
**ä¿®å¤æ—¥æœŸ**: 2025-12-31
**éªŒè¯äºº**: ___________
**éªŒè¯æ—¶é—´**: ___________

---

## ä¿®å¤å†…å®¹å›é¡¾

### ä¿®æ”¹çš„æ–‡ä»¶
- [x] `intelligent_project_analyzer/api/server.py` (2å¤„ä¿®æ”¹)
- [x] `frontend-nextjs/types/index.ts` (1å¤„ä¿®æ”¹)

### ä¿®å¤ç›®æ ‡
ä¿®å¤æœç´¢å·¥å…·å…¨æµç¨‹æ–­ç‚¹ï¼Œä½¿å‰ç«¯èƒ½å¤Ÿè·å–ä¸“å®¶æœç´¢å¼•ç”¨æ•°æ®ã€‚

---

## å¿«é€ŸéªŒè¯æ­¥éª¤

### âœ… æ­¥éª¤ 1: å¯åŠ¨æœåŠ¡å™¨

```bash
# åç«¯æœåŠ¡å™¨
cd d:\11-20\langgraph-design
python run_server_production.py
```

ç­‰å¾…çœ‹åˆ°æ—¥å¿—ï¼š
```
INFO:     Uvicorn running on http://0.0.0.0:8000
```

---

### âœ… æ­¥éª¤ 2: è¿è¡ŒéªŒè¯è„šæœ¬

```bash
# è‡ªåŠ¨éªŒè¯ï¼ˆæ¨èï¼‰
python verify_search_references_fix.py

# æˆ–æ‰‹åŠ¨æŒ‡å®šä¼šè¯IDéªŒè¯
python verify_search_references_fix.py <your-session-id>
```

**æœŸæœ›è¾“å‡º**:
```
========================================================================
æœç´¢å¼•ç”¨ä¿®å¤éªŒè¯ (v7.113)
========================================================================

æ­¥éª¤ 1: éªŒè¯APIæœåŠ¡å¥åº·çŠ¶æ€
âœ… APIæœåŠ¡æ­£å¸¸è¿è¡Œ

æ­¥éª¤ 2: è·å–æœ€æ–°çš„å·²å®Œæˆä¼šè¯
âœ… æ‰¾åˆ°å·²å®Œæˆä¼šè¯: xxx-xxx-xxx

æ­¥éª¤ 3: éªŒè¯æŠ¥å‘ŠAPIå“åº”
âœ… search_references å­—æ®µå­˜åœ¨ä¸”ä¸ºåˆ—è¡¨
   æœç´¢å¼•ç”¨æ•°é‡: X æ¡

éªŒè¯æ€»ç»“
âœ… åç«¯ä¿®å¤éªŒè¯é€šè¿‡
âœ… APIç«¯ç‚¹æ­£ç¡®è¿”å› search_references å­—æ®µ
ğŸ‰ ä¿®å¤éªŒè¯æˆåŠŸï¼
```

**éªŒè¯ç»“æœ**: [ ] é€šè¿‡ / [ ] å¤±è´¥

---

### âœ… æ­¥éª¤ 3: æ‰‹åŠ¨APIéªŒè¯ï¼ˆå¯é€‰ï¼‰

```bash
# è·å–ä¸€ä¸ªå·²å®Œæˆçš„ä¼šè¯ID
curl http://localhost:8000/api/debug/sessions

# æŸ¥çœ‹æŠ¥å‘Šå“åº”
curl http://localhost:8000/api/analysis/report/<session-id> | jq '.structured_report.search_references'
```

**æœŸæœ›ç»“æœ**: è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æœç´¢å¼•ç”¨å¯¹è±¡

**éªŒè¯ç»“æœ**: [ ] é€šè¿‡ / [ ] å¤±è´¥

---

### âœ… æ­¥éª¤ 4: å‰ç«¯æµè§ˆå™¨éªŒè¯

#### 4.1 å¯åŠ¨å‰ç«¯ï¼ˆå¦‚æœè¿˜æœªå¯åŠ¨ï¼‰
```bash
cd frontend-nextjs
npm run dev
```

#### 4.2 æµè§ˆå™¨éªŒè¯
1. è®¿é—®æŠ¥å‘Šé¡µé¢: `http://localhost:3000/report/<session-id>`
2. æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
3. åˆ‡æ¢åˆ° **Network** æ ‡ç­¾
4. åˆ·æ–°é¡µé¢
5. æ‰¾åˆ°è¯·æ±‚: `GET /api/analysis/report/<session-id>`
6. ç‚¹å‡»è¯¥è¯·æ±‚ â†’ **Response** æ ‡ç­¾
7. æœç´¢ `"search_references"`

**æœŸæœ›ç»“æœ**:
```json
{
  "structured_report": {
    "search_references": [
      {
        "source_tool": "bocha",
        "title": "...",
        "url": "...",
        "snippet": "...",
        "query": "...",
        "deliverable_id": "...",
        "timestamp": "..."
      }
    ]
  }
}
```

**éªŒè¯ç»“æœ**: [ ] çœ‹åˆ°æ•°æ® / [ ] æ•°æ®ä¸ºç©º / [ ] å­—æ®µç¼ºå¤±

#### 4.3 ConsoleéªŒè¯ï¼ˆå¯é€‰ï¼‰
åœ¨æµè§ˆå™¨Consoleä¸­æ‰§è¡Œï¼š
```javascript
// æŸ¥çœ‹æœç´¢å¼•ç”¨
console.log('æœç´¢å¼•ç”¨æ•°é‡:', report.structured_report?.search_references?.length);
console.log('æœç´¢å¼•ç”¨:', report.structured_report?.search_references);
```

**éªŒè¯ç»“æœ**: [ ] é€šè¿‡ / [ ] å¤±è´¥

---

## åç«¯æ—¥å¿—éªŒè¯

### å…³é”®æ—¥å¿—æ£€æŸ¥ç‚¹

#### 1. æœç´¢å·¥å…·æ‰§è¡Œæ—¥å¿—
```
ğŸ” åšæŸ¥æœç´¢: query='...', count=X
âœ… åšæŸ¥æœç´¢æˆåŠŸ: è¿”å› X æ¡ç»“æœ
```
**çœ‹åˆ°äº†å—**: [ ] æ˜¯ / [ ] å¦

#### 2. å·¥å…·è°ƒç”¨è®°å½•æ—¥å¿—
```
ğŸ”§ [v7.64] <role-id> å¯ç”¨å·¥å…·è°ƒç”¨è®°å½•å™¨
âœ… Tool completed: bocha_search, output_length=XXX
```
**çœ‹åˆ°äº†å—**: [ ] æ˜¯ / [ ] å¦

#### 3. æœç´¢å¼•ç”¨æå–æ—¥å¿—
```
ğŸ“š [v7.64] æå–äº† X æ¡æœç´¢å¼•ç”¨
âœ… Added X new references to state (total: Y)
```
**çœ‹åˆ°äº†å—**: [ ] æ˜¯ / [ ] å¦

#### 4. æŠ¥å‘Šç”Ÿæˆæ—¥å¿—
```
âœ… æˆåŠŸè§£æç»“æ„åŒ–æŠ¥å‘Šï¼ŒåŒ…å« X ä¸ªç« èŠ‚
```
**çœ‹åˆ°äº†å—**: [ ] æ˜¯ / [ ] å¦

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: search_references å­—æ®µç¼ºå¤±
**å¯èƒ½åŸå› **:
- [ ] æœåŠ¡å™¨æœªé‡å¯ï¼ˆä¿®æ”¹åéœ€è¦é‡å¯ï¼‰
- [ ] æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ­£ç¡®ä¿å­˜

**è§£å†³æ–¹æ³•**:
```bash
# é‡å¯æœåŠ¡å™¨
# Ctrl+C åœæ­¢
python run_server_production.py
```

---

### é—®é¢˜ 2: search_references ä¸º null
**å¯èƒ½åŸå› **:
- [ ] è¯¥ä¼šè¯æ²¡æœ‰è°ƒç”¨æœç´¢å·¥å…·
- [ ] æœç´¢å·¥å…·è°ƒç”¨å¤±è´¥
- [ ] ToolCallRecorder æœªè®°å½•

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥åç«¯æ—¥å¿—æ˜¯å¦æœ‰æœç´¢å·¥å…·è°ƒç”¨
2. è¿è¡Œä¸€æ¬¡æ–°çš„åˆ†æä»»åŠ¡
3. ç¡®ä¿æœç´¢å·¥å…·ï¼ˆBocha/Tavilyç­‰ï¼‰APIé…ç½®æ­£ç¡®

---

### é—®é¢˜ 3: search_references ä¸ºç©ºæ•°ç»„ []
**å¯èƒ½åŸå› **:
- [ ] æœç´¢å·¥å…·è¿”å›äº†ç©ºç»“æœ
- [ ] å·¥å…·è°ƒç”¨è®°å½•å™¨è§£æå¤±è´¥

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥æ—¥å¿—ä¸­çš„ "ğŸ“š [v7.64] æå–äº† X æ¡æœç´¢å¼•ç”¨"
2. å¦‚æœ X=0ï¼Œè¯´æ˜æ²¡æœ‰æˆåŠŸæå–
3. æ£€æŸ¥ `tool_callback.py` çš„è§£æé€»è¾‘

---

## éªŒè¯æ€»ç»“

### æ ¸å¿ƒéªŒè¯ç‚¹
- [ ] APIå“åº”åŒ…å« `search_references` å­—æ®µ
- [ ] å­—æ®µç±»å‹ä¸ºæ•°ç»„
- [ ] æ•°ç»„åŒ…å«æœ‰æ•ˆçš„æœç´¢å¼•ç”¨å¯¹è±¡
- [ ] å‰ç«¯æµè§ˆå™¨èƒ½çœ‹åˆ°æ•°æ®

### æœ€ç»ˆç»“è®º
- [ ] âœ… ä¿®å¤éªŒè¯é€šè¿‡ - å¯ä»¥éƒ¨ç½²
- [ ] âš ï¸  éƒ¨åˆ†é€šè¿‡ - éœ€è¦è¿›ä¸€æ­¥è°ƒè¯•
- [ ] âŒ éªŒè¯å¤±è´¥ - éœ€è¦å›æ»šä¿®å¤

---

## é™„å½•ï¼šæ•°æ®ç»“æ„å‚è€ƒ

### search_references æ•°ç»„å…ƒç´ ç»“æ„
```typescript
{
  source_tool: string;        // "bocha" | "tavily" | "arxiv" | "ragflow"
  title: string;              // æœç´¢ç»“æœæ ‡é¢˜
  url?: string;               // URLï¼ˆå¯é€‰ï¼‰
  snippet: string;            // æ‘˜è¦/ç‰‡æ®µ
  relevance_score?: number;   // ç›¸å…³æ€§è¯„åˆ†
  deliverable_id: string;     // å…³è”çš„äº¤ä»˜ç‰©ID
  query: string;              // æœç´¢æŸ¥è¯¢
  timestamp: string;          // æ—¶é—´æˆ³ (ISO 8601)
}
```

---

**å¤‡æ³¨**:
- å¦‚æœéªŒè¯å¤±è´¥ï¼Œè¯·ä¿å­˜å®Œæ•´çš„æ—¥å¿—æ–‡ä»¶
- è”ç³»å¼€å‘å›¢é˜Ÿæ—¶æä¾›æœ¬æ¸…å•çš„éªŒè¯ç»“æœ
