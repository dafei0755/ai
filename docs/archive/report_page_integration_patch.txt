"""
æŠ¥å‘Šé¡µé¢æœç´¢å¼•ç”¨ç»„ä»¶é›†æˆè¡¥ä¸ (v7.113)

æ­¤æ–‡ä»¶å±•ç¤ºäº†éœ€è¦åœ¨ frontend-nextjs/app/report/[sessionId]/page.tsx ä¸­æ·»åŠ çš„ä»£ç ã€‚

æ³¨æ„ï¼šè¿™ä¸æ˜¯å®Œæ•´çš„æ–‡ä»¶ï¼Œåªæ˜¯éœ€è¦æ·»åŠ /ä¿®æ”¹çš„éƒ¨åˆ†ã€‚
"""

# ==================== 1. åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ å¯¼å…¥ ====================
# ä½ç½®ï¼šåœ¨ç°æœ‰importè¯­å¥ä¹‹åæ·»åŠ 

import { SearchReferences } from '@/components/SearchReferences';
import { ExpertSearchReferences } from '@/components/ExpertSearchReferences';


# ==================== 2. åœ¨ renderContent() å‡½æ•°ä¸­é›†æˆç»„ä»¶ ====================
# ä½ç½®ï¼šåœ¨æŠ¥å‘Šå†…å®¹æ¸²æŸ“çš„æœ«å°¾ï¼Œreturnè¯­å¥ä¸­çš„ </div> ä¹‹å‰

# æ‰¾åˆ°è¿™æ®µä»£ç ï¼ˆçº¦ç¬¬910è¡Œï¼‰:
        )}
      </div>
    );
  };

# ä¿®æ”¹ä¸º:
        )}

        {/* ğŸ†• v7.113: æœç´¢å¼•ç”¨ - ä¸“å®¶ä½¿ç”¨çš„å‚è€ƒèµ„æ–™ */}
        {report.structuredReport?.search_references &&
         report.structuredReport.search_references.length > 0 && (
          <>
            {/* åˆ†éš”çº¿ */}
            <div className="border-t border-[var(--border-color)] my-8 opacity-30" />

            {/* æœç´¢å¼•ç”¨ç»„ä»¶ï¼ˆå¯é€‰æ‹©ä½¿ç”¨åŸºç¡€ç‰ˆæˆ–ä¸“å®¶åˆ†ç»„ç‰ˆï¼‰ */}

            {/* é€‰é¡¹1: ä¸“å®¶åˆ†ç»„ç‰ˆï¼ˆæ¨èï¼‰ */}
            <ExpertSearchReferences
              references={report.structuredReport.search_references}
              expertReports={report.structuredReport.expert_reports}
            />

            {/* é€‰é¡¹2: åŸºç¡€ç‰ˆï¼ˆå¤‡é€‰ï¼Œä¸ä¸Šé¢äºŒé€‰ä¸€ï¼‰
            <SearchReferences
              references={report.structuredReport.search_references}
            />
            */}
          </>
        )}
      </div>
    );
  };


# ==================== 3. å®Œæ•´çš„ä¿®æ”¹ç¤ºä¾‹ ====================
# ä»¥ä¸‹æ˜¯å®Œæ•´çš„renderContentå‡½æ•°æœ«å°¾éƒ¨åˆ†ç¤ºä¾‹ï¼š

  const renderContent = () => {
    // ... å‰é¢çš„ä»£ç ä¿æŒä¸å˜ ...

    return (
      <div className="space-y-6">
        {/* æŠ¥å‘Šå¤´éƒ¨ */}
        <div className="bg-[var(--card-bg)] border border-[var(--border-color)] rounded-2xl p-6">
          {/* ... å¤´éƒ¨å†…å®¹ ... */}
        </div>

        {/* ç»“æ„åŒ–æŠ¥å‘Šæˆ–åŸå§‹æ–‡æœ¬ */}
        {report.structuredReport ? (
          /* ç»“æ„åŒ–è§†å›¾ */
          <div className="grid grid-cols-1 lg:grid-cols-[1fr_300px] gap-6">
            {/* ... ç»“æ„åŒ–æŠ¥å‘Šå†…å®¹ ... */}
          </div>
        ) : (
          /* åŸå§‹æ–‡æœ¬è§†å›¾ */
          <div className="bg-[var(--card-bg)] border border-[var(--border-color)] rounded-2xl p-6">
            <div className="bg-[var(--sidebar-bg)] rounded-lg p-6 border border-[var(--border-color)] whitespace-pre-wrap font-mono text-sm text-gray-200 max-h-[70vh] overflow-y-auto">
              {report.reportText}
            </div>
          </div>
        )}

        {/* ğŸ†• v7.113: æœç´¢å¼•ç”¨ç»„ä»¶ */}
        {report.structuredReport?.search_references &&
         report.structuredReport.search_references.length > 0 && (
          <>
            <div className="border-t border-[var(--border-color)] my-8 opacity-30" />

            <ExpertSearchReferences
              references={report.structuredReport.search_references}
              expertReports={report.structuredReport.expert_reports}
            />
          </>
        )}
      </div>
    );
  };


# ==================== 4. å¯é€‰ï¼šæ·»åŠ è°ƒè¯•æ—¥å¿— ====================
# åœ¨ fetchReport å‡½æ•°ä¸­ï¼Œconsole.logä¹‹åæ·»åŠ ï¼š

console.log('ğŸ“Š æŠ¥å‘Šæ•°æ®æ£€æŸ¥:', {
  hasQuestionnaireResponses: !!result.structured_report?.questionnaire_responses,
  hasRequirementsAnalysis: !!result.structured_report?.requirements_analysis,
  hasCoreAnswer: !!result.structured_report?.core_answer,
  // ğŸ†• v7.113: æ·»åŠ æœç´¢å¼•ç”¨æ£€æŸ¥
  hasSearchReferences: !!result.structured_report?.search_references,
  searchReferencesCount: result.structured_report?.search_references?.length || 0,
});


# ==================== 5. æ ·å¼å®šåˆ¶ï¼ˆå¯é€‰ï¼‰====================
# å¦‚æœéœ€è¦è‡ªå®šä¹‰æ ·å¼ï¼Œå¯ä»¥åœ¨ç»„ä»¶å‘¨å›´æ·»åŠ åŒ…è£…å™¨ï¼š

<div className="search-references-section">
  <ExpertSearchReferences
    references={report.structuredReport.search_references}
    expertReports={report.structuredReport.expert_reports}
    className="custom-class"
  />
</div>

# ç„¶ååœ¨å…¨å±€CSSä¸­æ·»åŠ ï¼š
# frontend-nextjs/app/globals.css

.search-references-section {
  margin-top: 3rem;
  padding-top: 2rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}
