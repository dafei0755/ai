# å®¡æ ¸ç³»ç»Ÿ v2.0 é€’è¿›å¼è£å®šé“¾å®ç°æŠ¥å‘Š

**å®æ–½æ—¶é—´**: 2025-11-24  
**æ¶æ„å‡çº§**: ä»"å¤šè½®è¯„åˆ†è¿­ä»£"åˆ°"å•è½®é€’è¿›è£å®š"

---

## ğŸ¯ æ ¸å¿ƒå˜æ›´

### è®¾è®¡ç†å¿µè½¬å˜
- âŒ **æ—§æ¨¡å¼**: å„è¯´å„çš„ + å¤šè½®è¿­ä»£ + æ‰“åˆ†å†³ç­–
- âœ… **æ–°æ¨¡å¼**: é€’è¿›ä¼ é€’ + å•è½®æ·±åº¦ + å¯æ‰§è¡Œæ”¹è¿›è·¯çº¿å›¾

### æ¶æ„ä¼˜åŒ–
```
æ—§: çº¢é˜Ÿ || è“é˜Ÿ â†’ è¯„å§” â†’ ç”²æ–¹ â†’ ç»¼åˆè¯„åˆ† â†’ å¤šè½®è¿­ä»£
æ–°: çº¢é˜Ÿ â†’ è“é˜Ÿ(é€ä¸€éªŒè¯) â†’ è¯„å§”(é€ä¸€è£å†³) â†’ ç”²æ–¹(æœ€ç»ˆå†³ç­–) â†’ æ”¹è¿›å»ºè®®
```

---

## ğŸ“¦ ä¿®æ”¹æ¸…å•

### 1ï¸âƒ£ é…ç½®å±‚ (Prompts)

**æ–‡ä»¶**: `config/prompts/review_agents.yaml`

**å˜æ›´**:
- âœ… ç‰ˆæœ¬å‡çº§: v1.0 â†’ v2.0
- âœ… çº¢é˜Ÿæç¤ºè¯: ç§»é™¤æ‰“åˆ†ï¼Œè¾“å‡º `issues` æ•°ç»„ï¼ˆå¸¦ID: R1, R2...ï¼‰
- âœ… è“é˜Ÿæç¤ºè¯: æ·»åŠ  `validations` æ•°ç»„ï¼ˆé€ä¸€å›åº”çº¢é˜Ÿé—®é¢˜ï¼‰+ `strengths` æ•°ç»„
- âœ… è¯„å§”æç¤ºè¯: æ”¹ä¸º `rulings` æ•°ç»„ï¼ˆaccept/reject/modifyï¼‰+ `priority_ranking`
- âœ… ç”²æ–¹æç¤ºè¯: æ”¹ä¸º `accepted_improvements` + `final_ruling`ï¼ˆå¯æ‰§è¡Œè·¯çº¿å›¾ï¼‰

**æ ¸å¿ƒåˆ›æ–°**:
- é—®é¢˜IDè¿½è¸ª: R1 â†’ B1(éªŒè¯) â†’ J1(è£å†³) â†’ C1(å†³ç­–)
- å†³ç­–æƒå¨æ˜ç¡®: è¯„å§”ä¸“ä¸šè£å†³ï¼Œç”²æ–¹ä¸šåŠ¡å†³ç­–

---

### 2ï¸âƒ£ ä¸šåŠ¡é€»è¾‘å±‚ (Coordinator)

**æ–‡ä»¶**: `review/multi_perspective_review.py`

**å˜æ›´**:
- âœ… `conduct_review()`: é€’è¿›å¼å•è½®æµç¨‹ï¼ˆçº¢â†’è“â†’è¯„å§”â†’ç”²æ–¹ï¼‰
- âœ… `_conduct_red_team_review()`: ç‹¬ç«‹æ–¹æ³•ï¼Œè¾“å‡ºå¸¦IDé—®é¢˜
- âœ… `_conduct_blue_team_review()`: æ¥æ”¶ `red_review` å‚æ•°ï¼Œé€ä¸€éªŒè¯
- âœ… `_conduct_judge_review()`: æ¥æ”¶çº¢è“ç»“æœï¼Œè¾“å‡ºè£å†³
- âœ… `_conduct_client_review()`: æ¥æ”¶ `judge_review` å‚æ•°ï¼Œè¾“å‡ºæœ€ç»ˆå†³ç­–
- âœ… `_generate_final_ruling()`: ç”Ÿæˆæœ€ç»ˆè£å®šæ–‡æ¡£
- âœ… `_extract_improvement_suggestions()`: æå–æ”¹è¿›å»ºè®®åˆ—è¡¨
- âŒ åºŸå¼ƒ: `_make_final_decision()`, `_determine_decision()` ç­‰å¤šè½®è¿­ä»£é€»è¾‘

**å…³é”®æ”¹è¿›**:
- ç§»é™¤æ‰€æœ‰æ‰“åˆ†é€»è¾‘ï¼ˆ`score`, `overall_score`ï¼‰
- é—®é¢˜é€šè¿‡æ–¹æ³•å‚æ•°ä¼ é€’ï¼ˆä¸å†éœ€è¦å…¨å±€çŠ¶æ€ï¼‰
- è¾“å‡ºæ”¹è¿›å»ºè®®è€Œé `agents_to_rerun`

---

### 3ï¸âƒ£ å·¥ä½œæµå±‚ (Workflow Nodes)

**æ–‡ä»¶**: `workflow/main_workflow.py`

**å˜æ›´**:
- âœ… `_analysis_review_node()`: æ³¨é‡Šæ›´æ–°ä¸º"é€’è¿›å¼å•è½®å®¡æ ¸"

**æ–‡ä»¶**: `interaction/nodes/analysis_review.py`

**å˜æ›´**:
- âœ… `execute()`: ç®€åŒ–ä¸ºå•è½®å®¡æ ¸ï¼Œç§»é™¤å¤šè½®è¿­ä»£é€»è¾‘
- âœ… è¿”å›å­—æ®µ: `review_result`, `final_ruling`, `improvement_suggestions`
- âœ… è·¯ç”±: å®¡æ ¸åå›ºå®šåˆ° `detect_challenges`ï¼ˆä¸å†rerunï¼‰
- âœ… `_log_review_summary_v2()`: æ–°æ—¥å¿—æ–¹æ³•ï¼Œèšç„¦è£å®šç»“æœ
- âŒ åºŸå¼ƒ: `_route_to_specific_agents()`, `_find_best_round()` ç­‰å¤šè½®é€»è¾‘

---

### 4ï¸âƒ£ æ•°æ®å±‚ (State & Models)

**æ–‡ä»¶**: `core/state.py`

**å˜æ›´**:
- âœ… æ–°å¢å­—æ®µ:
  - `review_result: Optional[Dict[str, Any]]` - å®Œæ•´å®¡æ ¸ç»“æœ
  - `final_ruling: Optional[str]` - æœ€ç»ˆè£å®šæ–‡æ¡£
  - `improvement_suggestions: List[Dict[str, Any]]` - æ”¹è¿›å»ºè®®åˆ—è¡¨
- âœ… åˆå§‹åŒ–: åœ¨ `create_initial_state()` ä¸­åˆå§‹åŒ–æ–°å­—æ®µ

**æ–‡ä»¶**: `review/review_agents.py`

**å˜æ›´**:
- âœ… `BlueTeamReviewer.review()`: æ·»åŠ  `red_review` å‚æ•°
- âœ… `ClientReviewer.review()`: æ·»åŠ  `judge_review` å‚æ•°

---

### 5ï¸âƒ£ æŠ¥å‘Šå±‚ (Report Generation)

**æ–‡ä»¶**: `report/result_aggregator.py`

**å˜æ›´**:
- âœ… `get_task_description()`: æ·»åŠ å®¡æ ¸ç»“æœéƒ¨åˆ†
  - åŒ…å« `final_ruling`
  - åŒ…å« `improvement_suggestions` æ‘˜è¦ï¼ˆå‰5é¡¹ï¼‰
- âœ… ä»»åŠ¡è¦æ±‚: æ–°å¢"æ•´åˆå®¡æ ¸ç»“æœ"æŒ‡ä»¤

**å½±å“**:
- æœ€ç»ˆæŠ¥å‘Šå°†åŒ…å«å®¡æ ¸ç³»ç»Ÿçš„æ”¹è¿›å»ºè®®
- å¯æ‰§è¡Œçš„æ”¹è¿›è·¯çº¿å›¾å¯è§äºPDFè¾“å‡º

---

## ğŸ”„ æ•°æ®æµå¯¹æ¯”

### æ—§æµç¨‹ï¼ˆv1.0ï¼‰
```
ä¸“å®¶ç»“æœ â†’ çº¢é˜Ÿ(æ‰“åˆ†) â”
                      â”œâ†’ ç»¼åˆè¯„åˆ† â†’ å†³ç­–(approve/rerun) â†’ å¯èƒ½å¤šè½®
ä¸“å®¶ç»“æœ â†’ è“é˜Ÿ(æ‰“åˆ†) â”˜
```

### æ–°æµç¨‹ï¼ˆv2.0ï¼‰
```
ä¸“å®¶ç»“æœ â†’ çº¢é˜Ÿ(issues: R1,R2,R3)
           â†“
       è“é˜Ÿ(éªŒè¯æ¯ä¸ªissue + å‘ç°ä¼˜åŠ¿)
           â†“
       è¯„å§”(è£å†³æ¯ä¸ªissue + ä¼˜å…ˆçº§æ’åº)
           â†“
       ç”²æ–¹(ä¸šåŠ¡å†³ç­– + å¯æ‰§è¡Œè·¯çº¿å›¾)
           â†“
       final_ruling + improvement_suggestions â†’ æŠ¥å‘Š
```

---

## ğŸ“Š è¾“å‡ºæ ¼å¼ç¤ºä¾‹

### çº¢é˜Ÿè¾“å‡º
```json
{
  "issues": [
    {
      "id": "R1",
      "agent_id": "V3_å™äº‹ä¸“å®¶_3-1",
      "dimension": "functionality",
      "severity": "high",
      "description": "ç¼ºå°‘3ä¸ªå…·ä½“æ¡ˆä¾‹æ”¯æ’‘å™äº‹æ¦‚å¿µ",
      "evidence": "ç¬¬3æ®µä»…æä¾›æŠ½è±¡æè¿°...",
      "impact": "å¯èƒ½å¯¼è‡´æ–¹æ¡ˆè½åœ°å›°éš¾"
    }
  ],
  "summary": "çº¢é˜Ÿå‘ç°5ä¸ªé—®é¢˜ï¼Œå…¶ä¸­2ä¸ªcriticalï¼Œ3ä¸ªhigh"
}
```

### è“é˜Ÿè¾“å‡º
```json
{
  "validations": [
    {
      "red_issue_id": "R1",
      "stance": "partially_agree",
      "reasoning": "æ¡ˆä¾‹æ•°é‡ç¡®å®åå°‘ï¼Œä½†å™äº‹æ¡†æ¶å®Œæ•´",
      "severity_adjustment": "medium",
      "improvement_suggestion": "è¡¥å……2ä¸ªå›½é™…æ¡ˆä¾‹å³å¯"
    }
  ],
  "strengths": [
    {
      "id": "B1",
      "agent_id": "V4_è®¾è®¡ç ”ç©¶_4-1",
      "dimension": "depth",
      "description": "ç ”ç©¶æ·±åº¦è¾¾åˆ°å­¦æœ¯çº§åˆ«ï¼Œæœ‰åŸåˆ›æ€§æ´å¯Ÿ",
      "evidence": "å¼•ç”¨12ç¯‡å‰æ²¿è®ºæ–‡...",
      "value": "ä¸ºæ–¹æ¡ˆæä¾›åšå®ç†è®ºåŸºç¡€"
    }
  ]
}
```

### è¯„å§”è¾“å‡º
```json
{
  "rulings": [
    {
      "red_issue_id": "R1",
      "ruling": "accept",
      "final_severity": "medium",
      "reasoning": "ç»¼åˆçº¢è“è¯æ®ï¼Œæ¡ˆä¾‹ä¸è¶³ä½†å¯è¡¥æ•‘",
      "action_required": "V3_å™äº‹ä¸“å®¶éœ€è¡¥å……2ä¸ªæ¡ˆä¾‹ï¼Œå‚è€ƒBç«™æ–‡æ¡£",
      "deadline_priority": 1
    }
  ],
  "priority_ranking": ["R1", "R3", "R5"]
}
```

### ç”²æ–¹è¾“å‡º
```json
{
  "final_decision": "approve_with_conditions",
  "accepted_improvements": [
    {
      "issue_id": "R1",
      "judge_priority": 1,
      "business_priority": "must_fix",
      "deadline": "before_launch",
      "budget_allocated": "10%",
      "reasoning": "æ¡ˆä¾‹ä¸è¶³å½±å“å®¢æˆ·ä¿¡å¿ƒï¼Œå¿…é¡»ç«‹å³è¡¥å……"
    }
  ],
  "final_ruling": "## æ‰§è¡Œè·¯çº¿å›¾\n1. [must_fix] R1 - è¡¥å……æ¡ˆä¾‹ - immediately\n2. [should_fix] R3 - ä¼˜åŒ–åŠ¨çº¿ - before_launch"
}
```

---

## âœ… éªŒè¯æ¸…å•

- [x] é…ç½®æ–‡ä»¶æ›´æ–°ï¼ˆreview_agents.yaml v2.0ï¼‰
- [x] 4ä¸ªrevieweræç¤ºè¯é‡å†™å®Œæˆ
- [x] multi_perspective_review.pyæ ¸å¿ƒé€»è¾‘é‡æ„
- [x] analysis_review.pyç®€åŒ–ä¸ºå•è½®
- [x] state.pyæ·»åŠ æ–°å­—æ®µï¼ˆfinal_rulingç­‰ï¼‰
- [x] result_aggregator.pyé›†æˆå®¡æ ¸ç»“æœ
- [x] Pythonè¯­æ³•æ£€æŸ¥é€šè¿‡
- [ ] å®Œæ•´å·¥ä½œæµç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå¾…æ‰§è¡Œï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. **å¯åŠ¨æµ‹è¯•**: è¿è¡Œå®Œæ•´å·¥ä½œæµéªŒè¯æ–°å®¡æ ¸æµç¨‹
2. **å‰ç«¯é€‚é…**: æ›´æ–°UIæ˜¾ç¤ºfinal_rulingå’Œimprovement_suggestions
3. **æ–‡æ¡£æ›´æ–°**: æ›´æ–°CLAUDE.mdå’ŒREADMEåæ˜ æ–°æ¶æ„
4. **æ€§èƒ½ç›‘æ§**: è®°å½•å•è½®å®¡æ ¸çš„è€—æ—¶ vs æ—§å¤šè½®æµç¨‹

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### å…¼å®¹æ€§
- âœ… ä¿ç•™äº†æ—§å­—æ®µï¼ˆreview_history, best_scoreç­‰ï¼‰ä»¥å…¼å®¹ç°æœ‰ä»£ç 
- âš ï¸ åºŸå¼ƒæ–¹æ³•å·²æ ‡è®°ä½†æœªåˆ é™¤ï¼Œå¯åœ¨æµ‹è¯•é€šè¿‡åæ¸…ç†

### å…³é”®æ”¹è¿›ç‚¹
1. **å†³ç­–æƒå¨æ˜ç¡®**: è¯„å§”åšä¸“ä¸šåˆ¤æ–­ï¼Œç”²æ–¹åšä¸šåŠ¡å†³ç­–
2. **é—®é¢˜å¯è¿½æº¯**: R1â†’B1â†’J1â†’C1 å…¨é“¾è·¯è¿½è¸ª
3. **è¾“å‡ºå¯æ‰§è¡Œ**: final_rulingæ˜¯å¯ç›´æ¥ä½¿ç”¨çš„æ”¹è¿›è·¯çº¿å›¾
4. **æ•ˆç‡æå‡**: å•è½®æ·±åº¦å®¡æ ¸ vs å¤šè½®æµ…å±‚è¿­ä»£

### æ½œåœ¨é£é™©
- LLMå¯èƒ½ä¸éµå®ˆæ–°çš„è¾“å‡ºæ ¼å¼ï¼ˆéœ€éªŒè¯ï¼‰
- é—®é¢˜IDå¯èƒ½ä¸ä¸€è‡´ï¼ˆéœ€æ·»åŠ éªŒè¯é€»è¾‘ï¼‰
- å•è½®å®¡æ ¸å¯èƒ½æ¼æ‰æ·±å±‚é—®é¢˜ï¼ˆéœ€è§‚å¯Ÿå®é™…æ•ˆæœï¼‰

---

**å®æ–½çŠ¶æ€**: âœ… ä»£ç é‡æ„å®Œæˆï¼Œå¾…æµ‹è¯•éªŒè¯
