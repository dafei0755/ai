# ä»»åŠ¡åˆ†é…å†—ä½™æ ¹å› åˆ†ææŠ¥å‘Š

## é—®é¢˜æè¿°

**ç”¨æˆ·è¾“å…¥ï¼š**
```
ä¸­é¤åŒ…æˆ¿ï¼Œ8é—´æˆ¿ï¼Œä»¥è‹ä¸œå¡çš„è¯—è¯ï¼Œå‘½åï¼Œ4ä¸ªå­—ï¼Œä¼ é€’ç”Ÿæ´»æ€åº¦å’Œä»·å€¼è§‚,è¦æ±‚ä¸è½ä¿—å¥—
```

**æœŸæœ›åˆ†é…ï¼š**
- **ä¸»è´£**: V3_å™äº‹ä¸ä½“éªŒä¸“å®¶_3-3 (æ–‡åŒ–ç¬¦å·è½¬è¯‘ä¸“å®¶) - å‘½åæ˜¯æ ¸å¿ƒåˆ›æ„æ–‡æ¡ˆä»»åŠ¡
- **è¾…åŠ©**: V4_è®¾è®¡ç ”ç©¶å‘˜_4-1 (æ¡ˆä¾‹ç ”ç©¶) - æä¾›è‹ä¸œå¡è¯—è¯å‚è€ƒ

**å®é™…åˆ†é…ï¼š**
```
V5_åœºæ™¯ä¸è¡Œä¸šä¸“å®¶_5-4 (é…’åº—é¤é¥®è¿è¥ä¸“å®¶)
V6_ä¸“ä¸šæ€»å·¥ç¨‹å¸ˆ_6-3 (å®¤å†…å·¥è‰ºä¸ææ–™ä¸“å®¶)
V2_è®¾è®¡æ€»ç›‘_2-4 (é…’åº—é¤é¥®ç©ºé—´è®¾è®¡æ€»ç›‘)
V4_è®¾è®¡ç ”ç©¶å‘˜_4-1 (æ¡ˆä¾‹ä¸å¯¹æ ‡ç­–ç•¥å¸ˆ)
V3_å™äº‹ä¸ä½“éªŒä¸“å®¶_3-3 (æ–‡åŒ–ç¬¦å·è½¬è¯‘ä¸“å®¶)
```

**é—®é¢˜ï¼š** äº§ç”Ÿäº†3ä¸ªå†—ä½™è§’è‰²ï¼ˆV5-4, V6-3, V2-4ï¼‰ï¼Œå¯¼è‡´ä¸å¿…è¦çš„åˆ†æå’ŒTokenæ¶ˆè€—ã€‚

---

## æ ¹å› åˆ†æï¼šä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå†—ä½™

### æ ¹å› 1ï¼šé¡¹ç›®æ€»ç›‘è¢«"ä¸­é¤åŒ…æˆ¿"è¯¯å¯¼ï¼Œè¿‡åº¦èšç„¦ä¸šæ€è€Œéäº¤ä»˜ç‰©

#### è¯æ®æ¥è‡ªé…ç½®æ–‡ä»¶

[project_director.yaml:24-111](intelligent_project_analyzer/config/prompts/project_director.yaml#L24-L111)

é¡¹ç›®æ€»ç›‘çš„èŒè´£å®šä¹‰ï¼š

```yaml
### **ğŸ¯ ç¬¬é›¶éƒ¨åˆ†ï¼šäº¤ä»˜ç‰©è´£ä»»åˆ†é… (Deliverable Ownership Assignment) - v6.1æ–°å¢**

**ç¬¬ä¸€æ­¥ï¼šè¯†åˆ«æ‰€æœ‰MUST_HAVEäº¤ä»˜ç‰©**
- **ç›®æ ‡ï¼š** ä»éœ€æ±‚åˆ†æå¸ˆçš„è¾“å‡ºä¸­æå–æ‰€æœ‰ `priority="MUST_HAVE"` çš„äº¤ä»˜ç‰©

**ç¬¬äºŒæ­¥ï¼šä¸ºæ¯ä¸ªMUST_HAVEæŒ‡å®šè´£ä»»äºº(Owner)**
- **ç›®æ ‡ï¼š** æ¯ä¸ªMUST_HAVEäº¤ä»˜ç‰©å¿…é¡»æœ‰ä¸”ä»…æœ‰1ä¸ªè´£ä»»ä¸“å®¶
```

**ç¬¬äºŒæ­¥çš„è´£ä»»äººé€‰æ‹©è§„åˆ™ï¼š**
```yaml
ğŸ“ **æ–‡æ¡ˆ/å‘½å/å™äº‹ç±»**:
- naming_list (å‘½åæ–¹æ¡ˆ)
- brand_narrative (å“ç‰Œæ•…äº‹)
- copywriting_plan (æ–‡æ¡ˆç­–åˆ’)
  â†’ V3_å™äº‹ä¸å“ç‰Œä¸“å®¶ (æ–‡æ¡ˆã€å“ç‰Œå™äº‹æ˜¯å…¶æ ¸å¿ƒèƒ½åŠ›)
```

**é—®é¢˜ï¼š** é¡¹ç›®æ€»ç›‘è™½ç„¶æœ‰æ˜ç¡®çš„è§„åˆ™ï¼ˆå‘½åç±» â†’ V3ï¼‰ï¼Œä½†åœ¨å®é™…æ‰§è¡Œæ—¶ï¼Œ**"ä¸­é¤åŒ…æˆ¿"è¿™4ä¸ªå­—**è§¦å‘äº† **è¿‡åº¦ä¸šæ€åˆ†æ**ã€‚

---

### æ ¹å› 2ï¼šrole_selection_strategy.yaml çš„å…³é”®è¯åŒ¹é…é€»è¾‘è¿‡äºæ¿€è¿›

[role_selection_strategy.yaml:1126-1182](intelligent_project_analyzer/config/role_selection_strategy.yaml#L1126-L1182)

**V5-4: é…’åº—é¤é¥®è¿è¥ä¸“å®¶**
```yaml
"5-4":
  name: "é…’åº—é¤é¥®è¿è¥ä¸“å®¶"
  description: "...è´Ÿè´£åˆ†ææœåŠ¡æµç¨‹ã€åå¨æ•ˆç‡ã€å®¾å®¢ä½“éªŒå’Œç›ˆåˆ©æ¨¡å‹ã€‚"
  keywords: ["é…’åº—è¿è¥ç®¡ç†", "é¤é¥®è¿è¥ä¼˜åŒ–", "æœåŠ¡æµç¨‹è®¾è®¡", "åå¨åŠ¨çº¿ä¼˜åŒ–", "å®¾å®¢ä½“éªŒç®¡ç†", "æœåŠ¡æ•ˆç‡", "ç¿»å°ç‡", "æœåŠ¡ä½“éªŒè¿è¥"]
```

**V2-4: é…’åº—é¤é¥®ç©ºé—´è®¾è®¡æ€»ç›‘**
```yaml
"2-4":
  name: "é…’åº—é¤é¥®ç©ºé—´è®¾è®¡æ€»ç›‘"
  description: "...ä¸“æ³¨äºé¤å…ã€é…’åº—ã€é…’å§ã€åº¦å‡æ‘ç­‰ä½“éªŒå¼ç©ºé—´çš„è®¾è®¡ã€‚"
  keywords: ["é¤é¥®ç©ºé—´è®¾è®¡", "é¤å…è®¾è®¡", "é…’åº—è®¾è®¡", "åº¦å‡æ‘è®¾è®¡", "é…’å§è®¾è®¡", "å’–å•¡é¦†è®¾è®¡", "æ—…é¦†è®¾è®¡", "å¤œåº—è®¾è®¡", "æœåŠ¡ä½“éªŒç©ºé—´è®¾è®¡"]
```

**V6-3: å®¤å†…å·¥è‰ºä¸ææ–™ä¸“å®¶**
```yaml
"6-3":
  name: "å®¤å†…å·¥è‰ºä¸ææ–™ä¸“å®¶"
  description: "...è´Ÿè´£å°†è®¾è®¡æ„å›¾è½¬åŒ–ä¸ºå¯æ–½å·¥çš„å·¥è‰ºèŠ‚ç‚¹ã€‚"
  keywords: ["å®¤å†…", "å·¥è‰º", "ææ–™", "èŠ‚ç‚¹", "ç²¾è£…", "æ–½å·¥", "é¥°é¢", "ç»†èŠ‚"]
  applicable_scope: ["interior_design", "mixed"] # ğŸ†• ä»…é€‚ç”¨äºå®¤å†…/ç»¼åˆé¡¹ç›®
```

**åŒ¹é…é€»è¾‘ï¼š**
1. **ç”¨æˆ·è¾“å…¥åŒ…å«"ä¸­é¤åŒ…æˆ¿"** â†’ ç³»ç»Ÿæ¨æ–­é¡¹ç›®ç±»å‹ä¸º `commercial_enterprise` ï¼ˆä¿®å¤åâœ…ï¼‰
2. **å…³é”®è¯"é¤é¥®"è§¦å‘** â†’ V5-4ï¼ˆé…’åº—é¤é¥®è¿è¥ä¸“å®¶ï¼‰
3. **å…³é”®è¯"é¤å…è®¾è®¡"è§¦å‘** â†’ V2-4ï¼ˆé…’åº—é¤é¥®ç©ºé—´è®¾è®¡æ€»ç›‘ï¼‰
4. **æ¨æ–­æœ‰"ç©ºé—´è®¾è®¡"** â†’ V6-3ï¼ˆå®¤å†…å·¥è‰ºä¸ææ–™ä¸“å®¶ï¼‰

**é”™è¯¯å‡è®¾é“¾ï¼š**
```
"ä¸­é¤åŒ…æˆ¿"
â†’ "è¿™æ˜¯ä¸€ä¸ªé¤é¥®ç©ºé—´é¡¹ç›®"ï¼ˆâŒ é”™è¯¯å‡è®¾ï¼‰
â†’ "éœ€è¦é¤é¥®è¿è¥åˆ†æ" â†’ V5-4
â†’ "éœ€è¦é¤é¥®ç©ºé—´è®¾è®¡" â†’ V2-4
â†’ "éœ€è¦å®¤å†…å·¥è‰ºæ”¯æŒ" â†’ V6-3
```

**æ­£ç¡®ç†è§£ï¼š**
```
"ä¸­é¤åŒ…æˆ¿ï¼Œ8é—´æˆ¿ï¼Œå‘½å"
â†’ "è¿™æ˜¯ä¸€ä¸ªå‘½åæ–‡æ¡ˆé¡¹ç›®"ï¼ˆâœ… æ­£ç¡®ç†è§£ï¼‰
â†’ "éœ€è¦æ–‡åŒ–åˆ›æ„å’Œå‘½åç­–ç•¥" â†’ V3-3
â†’ "éœ€è¦è¯—è¯ç ”ç©¶æ”¯æŒ" â†’ V4-1
```

---

### æ ¹å› 3ï¼šé¡¹ç›®æ€»ç›‘ç¼ºå°‘"äº¤ä»˜ç‰©ç±»å‹â†’è§’è‰²è¾¹ç•Œ"çš„å¼ºåˆ¶åˆ¤æ–­

#### å½“å‰é…ç½®çš„ç›²ç‚¹

[project_director.yaml:49-99](intelligent_project_analyzer/config/prompts/project_director.yaml#L49-L99) è™½ç„¶å®šä¹‰äº†è´£ä»»äººé€‰æ‹©è§„åˆ™ï¼Œä½†**æ²¡æœ‰å¼ºåˆ¶çº¦æŸ"ç¦æ­¢"è§„åˆ™**ã€‚

**ç°æœ‰é…ç½®ï¼š**
```yaml
è´£ä»»äººé€‰æ‹©è§„åˆ™(å¼€æ”¾å¼å†³ç­–æŒ‡å—):
  ğŸ“ **æ–‡æ¡ˆ/å‘½å/å™äº‹ç±»**:
    â†’ V3_å™äº‹ä¸å“ç‰Œä¸“å®¶

  ğŸ¨ **è®¾è®¡ç­–ç•¥ç±»**:
    â†’ V2_è®¾è®¡æ€»ç›‘

  ğŸ“Š **ç ”ç©¶/åˆ†æç±»**:
    â†’ V4_è®¾è®¡ç ”ç©¶å‘˜
```

**ç¼ºå¤±çš„çº¦æŸï¼š**
```yaml
âŒ æ˜ç¡®çš„"åå‘æ’é™¤è§„åˆ™" (Anti-Pattern Rules)
âŒ äº¤ä»˜ç‰©ç±»å‹ä¸è§’è‰²è¾¹ç•Œçš„å¼ºåˆ¶æ£€æŸ¥
âŒ "å¦‚æœäº¤ä»˜ç‰©æ˜¯Xç±»å‹ï¼Œç¦æ­¢æ¿€æ´»Yè§’è‰²"çš„é€»è¾‘
```

---

### æ ¹å› 4ï¼šV4.0è™½ç„¶æ–°å¢äº† `deliverable_owner_suggestion`ï¼Œä½†é¡¹ç›®æ€»ç›‘æœªä¸¥æ ¼éµå®ˆ

[requirements_analyst_lite.yaml:212-219](intelligent_project_analyzer/config/prompts/requirements_analyst_lite.yaml#L212-L219)

**éœ€æ±‚åˆ†æå¸ˆçš„å»ºè®®ï¼š**
```yaml
"deliverable_owner_suggestion": {
  "primary_owner": "V3_å™äº‹ä¸ä½“éªŒä¸“å®¶_3-3",
  "owner_rationale": "å‘½åä»»åŠ¡æ ¸å¿ƒæ˜¯åˆ›æ„æ–‡æ¡ˆäº§å‡ºï¼Œå™äº‹ä¸“å®¶æœ€åŒ¹é…",
  "supporters": [],
  "anti_pattern": ["V2_è®¾è®¡æ€»ç›‘", "V6_å·¥ç¨‹å¸ˆ"]  # âš ï¸ ä¸åº”è¢«åˆ†é…æ­¤ä»»åŠ¡çš„è§’è‰²ç±»å‹
}
```

**é—®é¢˜ï¼š** é¡¹ç›®æ€»ç›‘é…ç½®æ–‡ä»¶è™½ç„¶æåˆ°"å‚è€ƒ`deliverable_owner_suggestion`"ï¼Œä½†ï¼š
1. **æ²¡æœ‰å¼ºåˆ¶æ‰§è¡Œ `anti_pattern` çš„é€»è¾‘**
2. **LLMå¯èƒ½å¿½ç•¥æˆ–è¯¯è§£è¿™ä¸ªå­—æ®µ**
3. **å…³é”®è¯è§¦å‘çš„æƒ¯æ€§æ€ç»´ï¼ˆ"ä¸­é¤åŒ…æˆ¿"=é¤é¥®ä¸šæ€ï¼‰è¦†ç›–äº†äº¤ä»˜ç‰©å¯¼å‘**

---

## æ ¹å› æ ‘çŠ¶å›¾

```
å†—ä½™è§’è‰²åˆ†é…ï¼ˆV5-4, V6-3, V2-4ï¼‰
â”‚
â”œâ”€â–º ç›´æ¥åŸå› ï¼šé¡¹ç›®æ€»ç›‘è¢«"ä¸­é¤åŒ…æˆ¿"è¯¯å¯¼ï¼Œè®¤ä¸ºæ˜¯é¤é¥®ç©ºé—´é¡¹ç›®
â”‚   â”‚
â”‚   â”œâ”€â–º å­åŸå› 1ï¼šå…³é”®è¯åŒ¹é…è¿‡äºæ¿€è¿›ï¼ˆ"é¤é¥®"â†’ V5-4, V2-4ï¼‰
â”‚   â”‚
â”‚   â””â”€â–º å­åŸå› 2ï¼šç¼ºå°‘"äº¤ä»˜ç‰©ç±»å‹ä¼˜å…ˆäºé¡¹ç›®ä¸šæ€"çš„åˆ¤æ–­é€»è¾‘
â”‚
â”œâ”€â–º æ·±å±‚åŸå› ï¼šproject_director.yaml ç¼ºå°‘å¼ºåˆ¶çš„"åå‘æ’é™¤è§„åˆ™"
â”‚   â”‚
â”‚   â”œâ”€â–º é…ç½®æ–‡ä»¶åªå®šä¹‰äº†"æ¨èè§„åˆ™"ï¼ˆXç±»å‹ â†’ Yè§’è‰²ï¼‰
â”‚   â”‚
â”‚   â””â”€â–º é…ç½®æ–‡ä»¶æœªå®šä¹‰"ç¦æ­¢è§„åˆ™"ï¼ˆXç±»å‹ ç¦æ­¢ Yè§’è‰²ï¼‰
â”‚
â””â”€â–º æ ¹æœ¬åŸå› ï¼šLLMæ¨ç†è¿‡ç¨‹ä¸­ï¼Œ**ä¸šæ€åˆ†æä¼˜å…ˆçº§ > äº¤ä»˜ç‰©åˆ†æä¼˜å…ˆçº§**
    â”‚
    â”œâ”€â–º LLMçš„é»˜è®¤å€¾å‘ï¼šçœ‹åˆ°"ä¸­é¤åŒ…æˆ¿"â†’ è”æƒ³"ç©ºé—´""è¿è¥""è®¾è®¡"
    â”‚
    â””â”€â–º v4.0çš„`deliverable_owner_suggestion.anti_pattern`æœªè¢«ä¸¥æ ¼æ‰§è¡Œ
```

---

## ç³»ç»Ÿæ€§é—®é¢˜ï¼šPhase 1.2 çš„"äº¤ä»˜ç‰©å¯¼å‘"ç†å¿µæœªå®Œå…¨è½åœ°

### Phase 1ç›®æ ‡ vs å®é™…æƒ…å†µ

| ç»´åº¦ | Phase 1ç›®æ ‡ | å®é™…æƒ…å†µ | å·®è· |
|------|------------|---------|------|
| **éœ€æ±‚åˆ†æå¸ˆ** | è¯†åˆ«äº¤ä»˜ç‰©+æä¾›ownerå»ºè®® | âœ… å·²å®ç° | æ—  |
| **é¡¹ç›®æ€»ç›‘** | æ ¹æ®äº¤ä»˜ç‰©åˆ†é…è´£ä»»äºº | âš ï¸ éƒ¨åˆ†å®ç° | **å…³é”®è¯è§¦å‘ä¼šè¦†ç›–äº¤ä»˜ç‰©å¯¼å‘** |
| **anti_patternçº¦æŸ** | ç¦æ­¢ä¸ç›¸å…³è§’è‰²å‚ä¸ | âŒ æœªå¼ºåˆ¶æ‰§è¡Œ | **LLMå¯èƒ½å¿½ç•¥** |
| **è§’è‰²æ¿€æ´»è¾¹ç•Œ** | æ˜ç¡®å“ªäº›ä»»åŠ¡ä¸éœ€è¦æŸè§’è‰² | âš ï¸ éƒ¨åˆ†å®šä¹‰ | **V6çš„ applicability_rules å­˜åœ¨ä½†æœªè”åŠ¨** |

---

## å…¸å‹é”™è¯¯æ¡ˆä¾‹å¯¹æ¯”

### Case 1: å‘½åä»»åŠ¡ï¼ˆå½“å‰åœºæ™¯ï¼‰

| è§’è‰² | æ˜¯å¦åº”å‚ä¸ | å®é™…å‚ä¸ | ç†ç”± |
|------|----------|---------|------|
| V3-3 (æ–‡åŒ–ç¬¦å·ä¸“å®¶) | âœ… ä¸»è´£ | âœ… å‚ä¸ | å‘½åæ˜¯åˆ›æ„æ–‡æ¡ˆæ ¸å¿ƒèƒ½åŠ› |
| V4-1 (æ¡ˆä¾‹ç ”ç©¶) | âœ… è¾…åŠ© | âœ… å‚ä¸ | æä¾›è¯—è¯ç ”ç©¶æ”¯æŒ |
| V5-4 (é¤é¥®è¿è¥) | âŒ ä¸åº”å‚ä¸ | âŒ **é”™è¯¯å‚ä¸** | **å‘½åä¸éœ€è¦è¿è¥åˆ†æ** |
| V2-4 (é¤é¥®è®¾è®¡) | âŒ ä¸åº”å‚ä¸ | âŒ **é”™è¯¯å‚ä¸** | **å‘½åä¸éœ€è¦ç©ºé—´è®¾è®¡** |
| V6-3 (å®¤å†…å·¥è‰º) | âŒ ä¸åº”å‚ä¸ | âŒ **é”™è¯¯å‚ä¸** | **å‘½åä¸éœ€è¦æ–½å·¥æŠ€æœ¯** |

### Case 2: å¦‚æœæ˜¯çœŸæ­£çš„é¤é¥®ç©ºé—´è®¾è®¡

```
ç”¨æˆ·è¾“å…¥ï¼š"è®¾è®¡ä¸€ä¸ª200å¹³ç±³ä¸­é¤å…ï¼ŒåŒ…å«8ä¸ªåŒ…æˆ¿ï¼Œé£æ ¼å‚è€ƒè‹ä¸œå¡çš„è¯—æ„ç¾å­¦"
```

| è§’è‰² | æ˜¯å¦åº”å‚ä¸ | ç†ç”± |
|------|----------|------|
| V2-4 (é¤é¥®è®¾è®¡) | âœ… ä¸»è´£ | **éœ€è¦ç©ºé—´è®¾è®¡** |
| V5-4 (é¤é¥®è¿è¥) | âœ… è¾…åŠ© | **éœ€è¦è¿è¥åˆ†æ** |
| V6-3 (å®¤å†…å·¥è‰º) | âœ… è¾…åŠ© | **éœ€è¦æ–½å·¥æŠ€æœ¯** |
| V3-3 (æ–‡åŒ–ç¬¦å·) | âœ… è¾…åŠ© | æä¾›"è‹ä¸œå¡è¯—æ„"çš„æ–‡åŒ–è§£è¯» |
| V4-1 (æ¡ˆä¾‹ç ”ç©¶) | âœ… è¾…åŠ© | æä¾›é¤é¥®ç©ºé—´æ¡ˆä¾‹å‚è€ƒ |

---

## ä¸ºä»€ä¹ˆV6-3æœ€ä¸åº”è¯¥å‡ºç°ï¼Ÿ

### V6çš„é€‚ç”¨è¾¹ç•Œå£°æ˜

[role_selection_strategy.yaml:1302-1325](intelligent_project_analyzer/config/prompts/role_selection_strategy.yaml#L1302-L1325)

```yaml
V6_ä¸“ä¸šæ€»å·¥ç¨‹å¸ˆ:
  applicability_rules:
    must_have_conditions:
      - "é¡¹ç›®æ¶‰åŠå»ºç­‘/ç©ºé—´çš„ç‰©ç†å®æ–½(ç»“æ„ã€ææ–™ã€æœºç”µã€æ–½å·¥ç­‰)"
      - "éœ€è¦æŠ€æœ¯å¯è¡Œæ€§è¯„ä¼°æˆ–æˆæœ¬ä¼°ç®—"
      - "éœ€è¦ææ–™é€‰å‹ã€å·¥è‰ºæŒ‡å¯¼æˆ–è´¨é‡æ§åˆ¶"
    must_not_activate_for:
      - "çº¯æ–‡æ¡ˆ/å‘½å/å“ç‰Œç­–ç•¥ç±»éœ€æ±‚(æ— ç‰©ç†ç©ºé—´å®æ–½)"
      - "çº¯ç ”ç©¶/åˆ†ææŠ¥å‘Šç±»éœ€æ±‚(æ— æŠ€æœ¯è½åœ°)"
      - "çº¯ç”¨æˆ·ä½“éªŒ/åœºæ™¯è®¾è®¡ç±»éœ€æ±‚(æ— å·¥ç¨‹å®ç°)"
    anti_pattern_examples:
      - scenario: "ä¸º8é—´åŒ…æˆ¿å‘½å"
        bad_response: "æ ¹æ®å‘½åæ¨èææ–™"
        good_response: "V6ä¸å‚ä¸,ç”±V3ç‹¬ç«‹å®Œæˆ"
        reason: "è¿‡åº¦å»¶ä¼¸ï¼Œå‘½åä»»åŠ¡æ— éœ€å·¥ç¨‹å¸ˆ"
```

**ğŸ”¥ å…³é”®è¯æ®ï¼š** é…ç½®æ–‡ä»¶å·²ç»æ˜ç¡®å®šä¹‰äº† `"ä¸º8é—´åŒ…æˆ¿å‘½å"` æ˜¯ V6 çš„ **anti_pattern**ï¼

**ä½†ä¸ºä»€ä¹ˆV6-3è¿˜æ˜¯è¢«æ¿€æ´»ï¼Ÿ**
â†’ å› ä¸º `applicability_rules` **ä»…å­˜åœ¨äº role_selection_strategy.yaml**ï¼Œè€Œ **project_director.yaml æ²¡æœ‰è¯»å–è¿™ä¸ªçº¦æŸ**ã€‚

---

## æ€»ç»“ï¼š3å±‚é˜²çº¿å…¨éƒ¨å¤±æ•ˆ

| é˜²çº¿ | è®¾è®¡ç›®çš„ | å®é™…æƒ…å†µ | å¤±æ•ˆåŸå›  |
|------|---------|---------|---------|
| **ç¬¬1å±‚ï¼šéœ€æ±‚åˆ†æå¸ˆçš„`anti_pattern`å»ºè®®** | æ˜ç¡®å‘ŠçŸ¥é¡¹ç›®æ€»ç›‘"ä¸è¦åˆ†é…V2/V6" | âš ï¸ å»ºè®®è¢«å¿½ç•¥ | LLMå¯èƒ½æœªé‡è§†æˆ–å…³é”®è¯è§¦å‘è¦†ç›– |
| **ç¬¬2å±‚ï¼šproject_director.yamlçš„è´£ä»»äººé€‰æ‹©è§„åˆ™** | "å‘½åç±»â†’V3"çš„æ˜ å°„è§„åˆ™ | âš ï¸ éƒ¨åˆ†æœ‰æ•ˆ | ä¸šæ€å…³é”®è¯è§¦å‘å¯¼è‡´å¤šè§’è‰²å‚ä¸ |
| **ç¬¬3å±‚ï¼šrole_selection_strategy.yamlçš„`applicability_rules`** | V6æ˜ç¡®å£°æ˜"å‘½åä»»åŠ¡ä¸å‚ä¸" | âŒ å®Œå…¨å¤±æ•ˆ | é¡¹ç›®æ€»ç›‘æœªè¯»å–æ­¤çº¦æŸ |

**æ ¸å¿ƒé—®é¢˜ï¼š** ä¸‰å±‚é˜²çº¿ä¹‹é—´**ç¼ºä¹å¼ºåˆ¶æ€§è”åŠ¨æœºåˆ¶**ï¼Œå¯¼è‡´ï¼š
1. éœ€æ±‚åˆ†æå¸ˆçš„å»ºè®®åªæ˜¯"å»ºè®®"ï¼Œä¸æ˜¯"æŒ‡ä»¤"
2. é¡¹ç›®æ€»ç›‘çš„è§„åˆ™æ˜¯"å¼€æ”¾å¼æŒ‡å—"ï¼Œä¸æ˜¯"ç¡¬æ€§çº¦æŸ"
3. è§’è‰²è¾¹ç•Œå£°æ˜å­˜åœ¨äºä¸åŒé…ç½®æ–‡ä»¶ï¼Œæœªåœ¨åˆ†é…æ—¶ç»Ÿä¸€éªŒè¯

---

## ä¸‹ä¸€æ­¥ä¿®å¤æ–¹å‘

### æ–¹æ¡ˆAï¼šå¢å¼ºé¡¹ç›®æ€»ç›‘çš„"äº¤ä»˜ç‰©ä¼˜å…ˆ"é€»è¾‘ï¼ˆæ¨èï¼‰

**ä¿®æ”¹ä½ç½®ï¼š** [project_director.yaml:24-111](intelligent_project_analyzer/config/prompts/project_director.yaml#L24-L111)

**å…³é”®æ”¹åŠ¨ï¼š**
```yaml
**ç¬¬é›¶æ­¥ï¼ˆæ–°å¢ï¼‰ï¼šäº¤ä»˜ç‰©ç±»å‹åˆ¤æ–­ä¸è§’è‰²è¾¹ç•Œæ£€æŸ¥**

åœ¨è¿›è¡Œè§’è‰²é€‰æ‹©ä¹‹å‰ï¼Œå¿…é¡»å…ˆå®Œæˆä»¥ä¸‹åˆ¤æ–­ï¼š

1. **æå–äº¤ä»˜ç‰©ç±»å‹**
   - ä»éœ€æ±‚åˆ†æå¸ˆçš„ primary_deliverables ä¸­è¯†åˆ«æ¯ä¸ªäº¤ä»˜ç‰©çš„ type å­—æ®µ
   - ç¤ºä¾‹ï¼šnaming_list, design_strategy, analysis_report

2. **å¼ºåˆ¶è¯»å– deliverable_owner_suggestion.anti_pattern**
   - å¦‚æœäº¤ä»˜ç‰©åŒ…å« anti_pattern å­—æ®µï¼Œ**ç¦æ­¢**æ¿€æ´»åˆ—è¡¨ä¸­çš„è§’è‰²ç±»å‹
   - ç¤ºä¾‹ï¼šnaming_list çš„ anti_pattern: ["V2_è®¾è®¡æ€»ç›‘", "V6_å·¥ç¨‹å¸ˆ"]
   - éªŒè¯è§„åˆ™ï¼šæ‰€æœ‰é€‰æ‹©çš„è§’è‰²ä¸å¾—åŒ…å« anti_pattern ä¸­çš„ç±»å‹

3. **åˆ¤æ–­æ˜¯å¦éœ€è¦V6ï¼ˆç‰©ç†å®æ–½åˆ¤æ–­ï¼‰**
   - âœ… å¦‚æœäº¤ä»˜ç‰©åŒ…å«ï¼šdesign_plan, technical_spec, material_selection
   - âŒ å¦‚æœäº¤ä»˜ç‰©ä»…åŒ…å«ï¼šnaming_list, brand_narrative, analysis_report
   - è§„åˆ™ï¼šçº¯æ–‡æ¡ˆ/ç­–ç•¥/ç ”ç©¶ç±»äº¤ä»˜ç‰©**ç¦æ­¢æ¿€æ´»V6**

4. **åˆ¤æ–­æ˜¯å¦éœ€è¦V2ï¼ˆç©ºé—´è®¾è®¡åˆ¤æ–­ï¼‰**
   - âœ… å¦‚æœç”¨æˆ·æ˜ç¡®æåˆ°"è®¾è®¡ç©ºé—´""å¹³é¢å›¾""å¸ƒå±€"
   - âŒ å¦‚æœç”¨æˆ·ä»…éœ€è¦"å‘½å""æ–‡æ¡ˆ""ç­–ç•¥""ç ”ç©¶"
   - è§„åˆ™ï¼šéç©ºé—´ç±»äº¤ä»˜ç‰©**ç¦æ­¢æ¿€æ´»V2**
```

### æ–¹æ¡ˆBï¼šå»ºç«‹"äº¤ä»˜ç‰©ç±»å‹â†’ç¦æ­¢è§’è‰²"ç¡¬æ€§æ˜ å°„è¡¨

**æ–°å¢é…ç½®æ–‡ä»¶ï¼š** `config/deliverable_role_constraints.yaml`

```yaml
# äº¤ä»˜ç‰©ç±»å‹ä¸è§’è‰²çº¦æŸæ˜ å°„è¡¨
constraints:
  naming_list:
    must_include: ["V3"]
    must_exclude: ["V2", "V6"]  # ğŸ”¥ ç¡¬æ€§çº¦æŸ
    optional: ["V4"]

  design_strategy:
    must_include: ["V2"]
    must_exclude: ["V6"]  # ç­–ç•¥ä¸éœ€è¦å·¥ç¨‹å¸ˆ
    optional: ["V3", "V4", "V5"]

  analysis_report:
    must_include: ["V4"]
    must_exclude: ["V2", "V6"]  # ç ”ç©¶ä¸éœ€è¦è®¾è®¡å’Œå·¥ç¨‹
    optional: ["V3", "V5"]
```

**é¡¹ç›®æ€»ç›‘ä»£ç æ”¹åŠ¨ï¼š** åœ¨ `select_roles_for_task` å‡½æ•°ä¸­å¢åŠ éªŒè¯é€»è¾‘
```python
def _validate_role_constraints(self, deliverables, selected_roles):
    """éªŒè¯è§’è‰²é€‰æ‹©æ˜¯å¦ç¬¦åˆäº¤ä»˜ç‰©çº¦æŸ"""
    for deliverable in deliverables:
        d_type = deliverable.get("type")
        constraints = load_constraints(d_type)  # ä»é…ç½®æ–‡ä»¶åŠ è½½

        for role in selected_roles:
            role_prefix = role.split("_")[0]  # V2, V3, V4ç­‰
            if role_prefix in constraints["must_exclude"]:
                raise ValueError(
                    f"âŒ äº¤ä»˜ç‰©ç±»å‹'{d_type}'ç¦æ­¢æ¿€æ´»è§’è‰²'{role}'\n"
                    f"åŸå› ï¼š{constraints['reason']}"
                )
```

### æ–¹æ¡ˆCï¼šPhase 1.2åç»­è¡¥ä¸ - "ä¸‰å±‚æ ¡éªŒæœºåˆ¶"

**å®ç°å±‚æ¬¡ï¼š**
1. **éœ€æ±‚åˆ†æå¸ˆå±‚ï¼ˆå·²æœ‰âœ…ï¼‰**ï¼šç”Ÿæˆ `anti_pattern` å»ºè®®
2. **é¡¹ç›®æ€»ç›‘å±‚ï¼ˆéœ€å¢å¼ºâš ï¸ï¼‰**ï¼šè¯»å–å¹¶å¼ºåˆ¶æ‰§è¡Œ `anti_pattern`
3. **è§’è‰²å®¡æ ¸å±‚ï¼ˆæ–°å¢ï¼‰**ï¼šåˆ†é…åäºŒæ¬¡æ ¡éªŒï¼Œæ‹¦æˆªä¸åˆç†åˆ†é…

**ä»£ç ä½ç½®ï¼š** `intelligent_project_analyzer/interaction/role_selection_review.py`

```python
def validate_deliverable_role_alignment(deliverables, role_distribution):
    """
    Phase 1.2è¡¥ä¸ï¼šæ ¡éªŒäº¤ä»˜ç‰©ä¸è§’è‰²åˆ†é…çš„å¯¹é½æ€§

    Returns:
        (is_valid, error_message)
    """
    for deliverable in deliverables:
        anti_patterns = deliverable.get("deliverable_owner_suggestion", {}).get("anti_pattern", [])

        for anti_pattern_prefix in anti_patterns:
            # æ£€æŸ¥æ˜¯å¦æœ‰è¿è§„è§’è‰²è¢«æ¿€æ´»
            for role_id in role_distribution.keys():
                if role_id.startswith(anti_pattern_prefix):
                    return False, (
                        f"âŒ äº¤ä»˜ç‰©'{deliverable['description']}'çš„åæ¨¡å¼æ£€æµ‹å¤±è´¥\n"
                        f"ç¦æ­¢æ¿€æ´»çš„è§’è‰²'{anti_pattern_prefix}'è¢«é”™è¯¯åˆ†é…\n"
                        f"å®é™…åˆ†é…çš„è§’è‰²ï¼š{list(role_distribution.keys())}"
                    )

    return True, ""
```

---

## ä¼˜å…ˆçº§å»ºè®®

| æ–¹æ¡ˆ | ä¼˜å…ˆçº§ | å®ç°éš¾åº¦ | é¢„æœŸæ•ˆæœ | å·¥ä½œé‡ |
|------|--------|---------|---------|--------|
| **æ–¹æ¡ˆA** | ğŸ”¥ P0 | ä¸­ | ç›´æ¥ä¿®å¤å½“å‰é—®é¢˜ | 2-3å°æ—¶ |
| **æ–¹æ¡ˆC** | ğŸ”¥ P0 | ä½ | é˜²æ­¢ç»•è¿‡ï¼Œå…œåº•æ‹¦æˆª | 1-2å°æ—¶ |
| **æ–¹æ¡ˆB** | P1 | é«˜ | é•¿æœŸå¯ç»´æŠ¤ï¼Œæ‰©å±•æ€§å¼º | 4-6å°æ—¶ |

**å»ºè®®æ‰§è¡Œé¡ºåºï¼š**
1. å…ˆå®æ–½ **æ–¹æ¡ˆA**ï¼ˆä¿®æ”¹project_director.yamlï¼‰â†’ ç«‹å³è§æ•ˆ
2. å†å®æ–½ **æ–¹æ¡ˆC**ï¼ˆå¢åŠ å®¡æ ¸å±‚ï¼‰â†’ é˜²æ­¢ç»•è¿‡
3. æœ€åå®æ–½ **æ–¹æ¡ˆB**ï¼ˆå»ºç«‹çº¦æŸæ˜ å°„è¡¨ï¼‰â†’ é•¿æœŸä¼˜åŒ–

---

## é™„å½•ï¼šéœ€æ±‚åˆ†æå¸ˆçš„è¾“å‡ºç¤ºä¾‹ï¼ˆæœŸæœ›ï¼‰

```json
{
  "primary_deliverables": [
    {
      "deliverable_id": "D1",
      "type": "naming_list",
      "description": "8ä¸ªåŒ…æˆ¿å‘½åæ–¹æ¡ˆï¼Œæ¥æºè‹ä¸œå¡è¯—è¯",
      "priority": "MUST_HAVE",
      "quantity": 8,
      "deliverable_owner_suggestion": {
        "primary_owner": "V3_å™äº‹ä¸ä½“éªŒä¸“å®¶_3-3",
        "owner_rationale": "å‘½åä»»åŠ¡æ ¸å¿ƒæ˜¯åˆ›æ„æ–‡æ¡ˆäº§å‡ºï¼Œå™äº‹ä¸“å®¶æœ€åŒ¹é…",
        "supporters": ["V4_è®¾è®¡ç ”ç©¶å‘˜_4-1"],  // æä¾›è¯—è¯ç ”ç©¶
        "anti_pattern": ["V2_è®¾è®¡æ€»ç›‘", "V6_å·¥ç¨‹å¸ˆ"]  // ğŸ”¥ ç¦æ­¢åˆ†é…
      }
    }
  ]
}
```

**é¡¹ç›®æ€»ç›‘ç†åº”éµå®ˆçš„é€»è¾‘ï¼š**
```
1. è¯»å– D1.type = "naming_list"
2. è¯»å– D1.deliverable_owner_suggestion.anti_pattern = ["V2", "V6"]
3. éªŒè¯ï¼šæœ€ç»ˆåˆ†é…çš„è§’è‰²ä¸­ï¼Œä¸å¾—åŒ…å«ä»»ä½•ä»¥"V2_"æˆ–"V6_"å¼€å¤´çš„è§’è‰²
4. å¦‚æœéªŒè¯å¤±è´¥ â†’ é‡æ–°é€‰æ‹©æˆ–æŠ¥é”™
```

**å½“å‰çš„Bugï¼š** æ­¥éª¤2-4æœªè¢«æ‰§è¡Œï¼Œå¯¼è‡´V2-4å’ŒV6-3é”™è¯¯æ¿€æ´»ã€‚
