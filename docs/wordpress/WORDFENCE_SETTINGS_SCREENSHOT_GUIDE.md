# 🛡️ Wordfence 配置指南（对照截图版）

> **严格对应您的 Wordfence 界面截图**  
> **更新日期**: 2025-12-15

---

## 📸 第1张截图：防火墙选项（顶部状态）

### 当前状态

```
✅ Web 应用防火墙：学习模式 (55%)
✅ 防火墙规则 社区：70%  
⚠️ 实时 IP 黑名单：启用 (0%)
✅ 强力防护：100% ✅
```

### 操作建议

**Web 应用防火墙（当前 55%）**:
```
现在：学习模式 ← 保持 7-14 天
↓
之后：切换到"启用并保护"
```

**操作**: 暂时不需要修改，等学习 1-2 周后再切换

---

## 📸 第2张截图：高级防火墙选项

### 位置：向下滚动看到的第一个配置区域

#### 1. "延迟国家 / 地区的 IP 地址或网段并允许访问此站点"

**这个大文本框**（截图中可以看到提示 127.0.0.1/24, 127.0.0.1-127.1 等）

**建议添加**：
```
127.0.0.1
::1
localhost
```

**原因**: 允许本地开发环境访问

---

#### 2. "允许列出的服务"部分

**您已勾选的**（保持即可）：
- ✅ Sucuri
- ✅ Facebook  
- ✅ Uptime Robot
- ✅ StatusCake
- ✅ Seznam Search Engine
- ✅ Google Search Engine

**建议**: 保持当前勾选，无需修改

---

#### 3. "立即解除屏蔽访问的 URL 或 IP"

**这个输入框** + **Param Type 下拉菜单** + **参数名称输入框**

**🔥 关键配置（针对 SSO）**：

**添加第1条规则**：
```
路径（第一个输入框）: /wp-json/nextjs-sso/v1/get-token
Param Type（下拉菜单）: URL Path
参数名称（第三个输入框）: 留空
```
点击右侧"添加"按钮

**添加第2条规则**：
```
路径: /wp-json/nextjs-sso/v1/verify-user
Param Type: URL Path
参数名称: 留空
```
点击"添加"

**添加第3条规则**：
```
路径: /js
Param Type: URL Path
参数名称: 留空
```
点击"添加"

**为什么**: 这些是 SSO 必需的路径，防止被 Wordfence 拦截

---

## 📸 第3张截图：规则（Rules）

### 您当前启用的规则（都是 ✅）

```
✅ whitelist - Whitelisted URL
✅ lfi - Slider Revolution <= 4.1.4 - Directory Traversal
✅ sqli - SQL Injection
✅ xss - XSS: Cross Site Scripting
✅ file_upload - Malicious File Upload
✅ traversal - Directory Traversal
✅ lfi - LFI: Local File Inclusion
✅ xxe - XXE: External Entity Expansion
✅ xss - DZS Video Gallery <= 8.60...
```

**建议**: ✅ **全部保持启用，不要修改**

点击底部"手动添加新规则"按钮可以跳过（暂时不需要）

---

## 📸 第4张截图：强力防护

### 当前配置（100% ✅ 很好）

```
✅ 启用强力防护: 已勾选

在登录失败次数达到: 20  
  建议: 改为 15（更严格一点）

在登录失败次数达到后封锁: 20
  建议: 改为 20（保持）

在多长时间内的达到失败次数: 4 小时
  建议: 保持 4 小时

用户被锁定的时长: 4 小时  
  建议: 保持 4 小时
```

### 下方的复选框选项

**当前看到的选项**（根据截图）：

```
□ 立即锁定无效用户名
  建议: ✅ 勾选（防止用户名枚举攻击）

□ 立即解除管理员对其密码的锁定
  建议: ❌ 不勾选（管理员也应遵守锁定规则）
```

---

## 📸 第5张截图：其他选项（杂项/Miscellaneous）

### 您已勾选的选项（全部保持）

```
✅ 强制使用密码强度 ← 保持勾选
✅ 不要让 WordPress 在登录错误时显示用户名 ← 保持勾选
✅ 屏蔽用户注册 [admin] 用户名 ← 保持勾选
✅ 防止遮蔽 [/author-N] 挂钩，oEmbed API，WordPress REST API... ← 保持勾选
✅ 禁用 WordPress 应用程序密码 ← 保持勾选
```

### 未勾选的选项

```
□ 屏蔽虚假 Google 蜘蛛程序对站点的访问
  建议: ❌ 不勾选（可能误杀）

□ 屏蔽国家/地区以 User-Agent 和 Referer 验证 POST 请求中 IP
  建议: ❌ 不勾选（除非特定需求）
```

### 底部文本框："显示全部页面显示自定义文本"

**建议**: 留空（不需要自定义文本）

### 最后两个复选框

```
✅ 检查配置更新时讨论新密码强度 ← 保持勾选
✅ 参与实时 Wordfence 安全网络 ← 保持勾选（重要！）
```

---

## 📸 第6张截图：限连（Rate Limiting）

### 配置项

```
我有这些同意对何种 Google 的网络工具:
  下拉菜单: 已验证的 Google 爬虫全不会受比影响
  建议: 保持当前选择

如何任何人类的请求超时:
  下拉菜单: 不限制
  第二个下拉菜单: 然后
  建议: 可以改为"60 个页面或帖子"/"节流仅"
  
  🔥 重要：如果改为限制，需要排除 SSO 路径！

如果抓取工具是的网页流量超时:
  建议: 保持"不限制"

如果是否找不到的页面 (404s) 请求超时:
  建议: 改为"20"/"5 分钟"/"节流仅"
  （防止 404 扫描攻击）

如果某人类的页面到没超时:
  建议: 保持"不限制"

如果某人类请求的页面 (404s) 超时:
  建议: 改为"10"/"5 分钟"/"节流仅"

IP 地址在速反规则时删除最长时间:
  下拉菜单: 5 分钟
  建议: 改为"30 分钟"（更长的封禁时间）
```

### ⚠️ 重要提示

如果您修改了"如何任何人类的请求超时"，必须在第2张截图的"立即解除屏蔽访问的 URL 或 IP"中添加 SSO 路径豁免（已在上面说明）

---

## 📸 第7张截图：允许的网址（Learning Mode 白名单）

### 当前表格显示

```
路径                           参数                    创建                状态
/index.php                    request.queryString[c]  2025/12/14 19:39:02  Allowlisted while in Learning Mode
/index.php                    server.empty            2025/12/14 19:39:02  Allowlisted while in Learning Mode
/index.php                    request.queryString[q]  2025/12/14 19:39:02  Allowlisted while in Learning Mode
...
```

### 操作建议

**这些是学习模式自动添加的白名单**

1. **定期审查**：每周检查一次，删除可疑路径
2. **切换到保护模式后**：这些规则会继续生效
3. **如果发现恶意路径**：取消勾选前面的复选框，点击"删除"

### 🔥 手动添加 SSO 白名单

**在表格上方的输入框中添加**：

```
路径: /wp-json/nextjs-sso/v1/get-token
Param Type: POST Body（下拉菜单）
参数名称: 留空
```
点击"添加"按钮

重复操作添加：
- `/wp-json/nextjs-sso/v1/verify-user`
- `/js`

---

## 🎯 优先级操作清单

### 立即执行（5分钟内）

- [ ] **第2张截图** → "立即解除屏蔽访问的 URL 或 IP" → 添加 3 条 SSO 路径
  - `/wp-json/nextjs-sso/v1/get-token`
  - `/wp-json/nextjs-sso/v1/verify-user`
  - `/js`

- [ ] **第2张截图** → 大文本框 → 添加本地 IP
  ```
  127.0.0.1
  ::1
  ```

- [ ] **第4张截图** → 失败次数改为 `15`

- [ ] **第4张截图** → 勾选"立即锁定无效用户名"

---

### 本周内完成

- [ ] **第6张截图** → 404 错误限制改为 `20 个 / 5 分钟 / 节流仅`

- [ ] **第6张截图** → IP 封禁时长改为 `30 分钟`

- [ ] **测试 SSO 登录流程**（确认无误拦截）

---

### 1-2周后执行

- [ ] **第1张截图** → Web 应用防火墙切换到"启用并保护"

- [ ] **第7张截图** → 审查学习模式白名单，删除可疑路径

---

## 🧪 测试验证

**完成配置后，执行以下测试**：

### 测试1: SSO Token 获取

```bash
# 在浏览器访问（已登录 WordPress）
https://www.ucppt.com/wp-json/nextjs-sso/v1/get-token

# 预期结果: 返回 JSON 包含 token
# 如果返回 403/429，说明被 Wordfence 拦截
```

### 测试2: 检查实时流量

```
Wordfence → Tools → Live Traffic → 搜索 "nextjs-sso"
```

**预期**: 看到 SSO 请求状态为 "200 OK"，而不是 "Blocked"

### 测试3: 强力防护

```
1. 故意输错密码 15 次
2. 第 16 次应该被锁定
3. 检查 Wordfence → Blocking → 确认 IP 在锁定列表
```

---

## 📞 需要帮助？

如果某个配置项找不到或对不上：

1. 告诉我具体是哪张截图
2. 告诉我是哪个配置项名称
3. 我会精确定位并提供操作步骤

---

**文档版本**: v2.0（严格对照截图版）  
**更新日期**: 2025-12-15
