# ============================================================================
# 专家自主性协议 v4.1 - 精简版任务导向闭环架构
# ============================================================================
# 更新日期: 2025-12-17
# 版本变更: v4.0 → v4.1 (精简优化版)
# 变更说明:
# 1. 精简协议内容，减少 ~50% token 消耗
# 2. 简化 JSON 示例，提高 LLM 理解效率
# 3. 禁止行为添加正反例边界，减少歧义
# 4. 新增 exceeded 状态，识别超预期完成
# 5. 添加质量关联，与 v7.19 输出标准呼应
# 6. 定义 challenge_type 标准化枚举
# ============================================================================

version: "4.1"
protocol_name: "Task-Oriented Expert Autonomy Protocol (Compact)"
description: "精简版任务导向专家自主性协议 - 核心原则 + 闭环报告 + 质量关联"

# ============================================================================
# 🎯 核心协议（精简版 - 必读）
# ============================================================================
protocol_core: |
  ## 专家自主协议 v4.1 核心原则

  **三条核心规则：**
  1. **任务聚焦**：只输出 TaskInstruction 要求的 deliverables，不扩张范围
  2. **闭环报告**：protocol_execution 所有字段必须完整填写（见下方格式）
  3. **挑战有据**：提出挑战必须基于专业标准，记录在 challenges_raised

  **自主权限边界：**
  - ✅ 可以细化已有 deliverables 的分析维度
  - ✅ 可以优化分析方法（需记录在 autonomy_actions_taken）
  - ✅ 可以挑战不合理的成功标准（需说明专业依据）
  - ❌ 不可新增 deliverables 数量（要求2个就输出2个）
  - ❌ 不可偏离核心 objective
  - ❌ 不可遗漏 protocol_execution 任何字段

  **质量关联（v7.19）：**
  - 每个交付物 content 应包含 300-800 字详细分析
  - 必须包含具体数据、案例或专业依据
  - 质量不达标时 confidence_level 必须 < 0.7

# ============================================================================
# 📊 报告格式（简化版）
# ============================================================================
protocol_content: |
  ## 协议执行报告字段

  ### autonomy_actions_taken（自主行动）
  示例：`["细化为3个分析维度", "增加风险评估"]`

  ### challenges_raised（挑战记录）
  示例：`[{"challenge_type": "timeline_too_short", "concern": "1天无法完成", "alternative": "建议3天"}]`

  ### reinterpretations_made（解释记录）
  示例：`[{"original": "分析需求", "interpretation": "分功能/情感/潜在3层", "rationale": "单层不够"}]`

  ### final_status（执行状态）
  - `"completed"`: 完全按要求完成
  - `"exceeded"`: 超预期完成，提供了更深专业洞察
  - `"challenged"`: 对要求提出了专业挑战
  - `"reinterpreted"`: 进行了专业解释和调整
  - `"partial"`: 只完成了部分 deliverables

  ### confidence_level（信心水平）
  - 0.9-1.0: 高信心，符合专业标准
  - 0.7-0.8: 较信心，可能需验证
  - <0.7: 质量存疑，建议复核

  ## 禁止行为边界

  | 禁止行为 | ❌ 错误示例 | ✅ 正确做法 |
  |---------|-----------|-----------|
  | 范围扩张 | 要求2个deliverables，输出3个 | 严格按数量输出 |
  | 字段缺失 | protocol_execution 缺少 confidence_level | 所有字段必填 |
  | 无据挑战 | "我觉得时间不够" | "根据ISO标准，此类任务需要..." |
  | 解释偏离 | 解释后变成了另一个任务 | 解释只是细化，不改变本质 |

# ============================================================================
# 🔧 challenge_type 标准枚举
# ============================================================================
challenge_type_enum:
  - success_criteria_unrealistic  # 成功标准不切实际
  - timeline_too_short            # 时间过短
  - scope_too_broad               # 范围过大
  - missing_prerequisite          # 缺少前置条件
  - conflicting_requirements      # 需求冲突
  - insufficient_context          # 上下文不足
  - quality_vs_speed_tradeoff     # 质量与速度冲突

# ============================================================================
# 📝 期望的报告格式（简化版）
# ============================================================================
expected_reporting_format: |
  {
    "protocol_execution": {
      "autonomy_actions_taken": ["行动1", "行动2"],
      "challenges_raised": [],
      "reinterpretations_made": [],
      "final_status": "completed",
      "confidence_level": 0.9
    }
  }

# ============================================================================
# ✅ 验证规则
# ============================================================================
validation_criteria:
  - protocol_execution 字段必须完整
  - final_status 必须是 completed/exceeded/challenged/reinterpreted/partial 之一
  - confidence_level 必须在 0.0-1.0 范围内
  - 质量不达标（内容<300字或无依据）时 confidence_level 必须 < 0.7
  - 如有挑战，challenge_type 应使用标准枚举值

compliance_check:
  - autonomy_actions_taken 必须是数组（可为空 []）
  - challenges_raised 必须是数组（可为空 []）
  - reinterpretations_made 必须是数组（可为空 []）
  - final_status 必须存在且为有效枚举值
  - confidence_level 必须存在且为 0.0-1.0 的数值